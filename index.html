<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>软件可靠性分析平台 - 模板</title>
    <!-- Chart.js 图表库 - 使用最新稳定版本 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <!-- Chart.js 插件：增强工具提示和动画 -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        :root {
            --primary: #1a6c7e;
            --primary-dark: #0f4f5a;
            --primary-light: #e5f2f4;
            --sidebar-grad-start: #13424e;
            --sidebar-grad-end: #0b2530;
            --text-dark: #1d2b36;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Microsoft YaHei", Arial, sans-serif; }
        body { min-height: 100vh; background: #f7f3ec; color: var(--text-dark); }
        .app {
            display: flex;
            min-height: 100vh;
        }
        .app.hidden {
            display: none;
        }
        .sidebar {
            width: 220px;
            background: linear-gradient(180deg, var(--sidebar-grad-start), var(--sidebar-grad-end));
            color: #fff;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
        }
        .sidebar h1 {
            font-size: 18px;
            text-align: center;
            margin-bottom: 20px;
        }
        .menu-section { margin-bottom: 20px; }
        .menu-section-title {
            font-size: 14px;
            padding: 10px 20px;
            color: #c9d9ff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .menu-item {
            padding: 10px 30px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .menu-item.active,
        .menu-item:hover { background: rgba(255,255,255,0.15); }

        .sidebar-footer {
            margin-top: auto;
            padding: 16px 20px;
            border-top: 1px solid rgba(255,255,255,0.15);
            font-size: 13px;
            line-height: 1.6;
        }
        .sidebar-footer strong {
            display: block;
            margin-bottom: 6px;
            color: #b6dbee;
        }
        .sidebar-footer details {
            margin-bottom: 4px;
        }
        .sidebar-footer summary {
            list-style: none;
            cursor: pointer;
            color: #e2f3ff;
        }
        .sidebar-footer summary::-webkit-details-marker {
            display: none;
        }
        .sidebar-footer small {
            color: #cfe9ff;
            font-size: 12px;
        }

        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .top-banner {
            background: #0f2a32;
            padding: 0;
            height: 140px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .top-banner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .header {
            background: var(--primary);
            padding: 16px 40px;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h2 { font-size: 22px; }
        .content {
            padding: 30px 40px;
            background: #fff;
            flex: 1;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--primary-light);
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            border-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }
        .card {
            border: 1px solid var(--primary-light);
            border-radius: 6px;
            padding: 20px;
        }
        .model-panel { display: none; }
        .model-panel.active { display: block; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-row { margin-bottom: 16px; }
        label { display: block; margin-bottom: 6px; color: var(--primary-dark); font-weight: bold; }
        select, input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #c0dfe5;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }
        .actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }
        .btn {
            padding: 10px 24px;
            border-radius: 20px;
            border: none;
            font-size: 14px;
            cursor: pointer;
        }
        .btn.secondary { background: var(--primary-light); color: var(--primary-dark); }
        .btn.primary { background: var(--primary); color: #fff; }
        .failure-layout { display: flex; gap: 24px; }
        .dataset-card {
            width: 260px;
            border: 1px solid var(--primary-light);
            border-radius: 6px;
            padding: 16px;
            background: #fffdf8;
        }
        .dataset-card p { margin-top: 12px; color: var(--primary-dark); font-weight: bold; }
        .data-panel { flex: 1; }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 12px;
            font-size: 14px;
        }
        .filter-row {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .filter-row > div {
            min-width: 160px;
            flex: 1;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
        }
        .stat-card {
            border-radius: 6px;
            padding: 14px 16px;
            background: var(--primary-light);
            border: 1px solid #c9e4e8;
        }
        .stat-card h4 {
            font-size: 14px;
            color: var(--primary-dark);
            margin-bottom: 6px;
        }
        .stat-card p {
            font-size: 13px;
            color: #555;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #c7d6f3;
            padding: 8px;
            text-align: center;
        }
        th { background: #f0f6f6; color: var(--primary-dark); }
        .login-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, rgba(19,66,78,0.92), rgba(10,37,48,0.95));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        .login-card {
            width: 360px;
            background: #ffffff;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
        }
        .login-card h2 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-dark);
        }
        .login-card .form-row { margin-bottom: 20px; }
        .login-card button {
            width: 100%;
            border-radius: 30px;
        }
        .login-error {
            color: #c7393d;
            font-size: 13px;
            text-align: center;
            min-height: 18px;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h2>软件可靠性分析平台</h2>
            <div class="login-error" id="loginError"></div>
            
            <div class="form-row">
                <label>账户</label>
                <input type="text" id="loginUser" placeholder="请输入账户名，例如 admin" />
            </div>
            <div class="form-row">
                <label>密码</label>
                <input type="password" id="loginPass" placeholder="请输入密码" />
            </div>
            
            <!-- 数据库配置（可选，如果默认配置无法连接时使用） -->
            <details style="margin-bottom:15px; padding:10px; background:#f0f6f6; border-radius:4px; cursor:pointer;">
                <summary style="color:var(--primary-dark); font-weight:bold; font-size:13px;">数据库配置（可选，默认：localhost/root/空密码/user_db）</summary>
                <div style="margin-top:10px;">
                    <div style="margin-bottom:10px;">
                        <label style="display:block; margin-bottom:4px; font-size:12px;">主机</label>
                        <input type="text" id="loginDbHost" placeholder="localhost" value="localhost" style="width:100%; padding:6px; border:1px solid #c7d6f3; border-radius:4px;" />
                    </div>
                    <div style="margin-bottom:10px;">
                        <label style="display:block; margin-bottom:4px; font-size:12px;">用户名</label>
                        <input type="text" id="loginDbUser" placeholder="root" value="root" style="width:100%; padding:6px; border:1px solid #c7d6f3; border-radius:4px;" />
                    </div>
                    <div style="margin-bottom:10px;">
                        <label style="display:block; margin-bottom:4px; font-size:12px;">密码</label>
                        <input type="password" id="loginDbPassword" placeholder="MySQL密码（如果设置了）" style="width:100%; padding:6px; border:1px solid #c7d6f3; border-radius:4px;" />
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:4px; font-size:12px;">数据库</label>
                        <input type="text" id="loginDbDatabase" placeholder="user_db" value="user_db" style="width:100%; padding:6px; border:1px solid #c7d6f3; border-radius:4px;" />
                    </div>
                </div>
            </details>
            
            <button class="btn primary" id="loginBtn">登录</button>
            <div style="margin-top:15px; font-size:12px; color:#666; text-align:center;">
                <p>默认账号：admin / 123</p>
                <p style="margin-top:4px; color:#999;">如果默认数据库配置无法连接，请展开上方"数据库配置"进行设置</p>
            </div>
        </div>
    </div>
    <div class="app hidden" id="appContainer">
    <aside class="sidebar">
        <h1>软件可靠性分析平台</h1>
        <div class="menu-section">
            <div class="menu-section-title">经典可靠性模型</div>
            <div class="menu-item active" data-model="jm">JM 模型</div>
            <div class="menu-item" data-model="go">GO 模型</div>
        </div>
        <div class="menu-section">
            <div class="menu-section-title">时间序列模型</div>
            <div class="menu-item" data-model="emd">经验模态分解模型</div>
        </div>
        <div class="menu-section">
            <div class="menu-section-title">SOA 可靠性模型</div>
            <div class="menu-item" data-model="markov">Markov 模型</div>
        </div>
        <div class="menu-section">
            <div class="menu-section-title">模型对比分析</div>
            <div class="menu-item" data-model="perf_compare">性能对比分析</div>
            <div class="menu-item" data-model="slr_compare">SLR 对比分析</div>
        </div>
        <div class="menu-section">
            <div class="menu-section-title">系统管理</div>
            <div class="menu-item" data-model="user_mgmt">用户管理</div>
            <div class="menu-item" id="logoutItem">登出账号</div>
        </div>
        <div class="sidebar-footer">
            <strong>系统编写人员</strong>
            <details>
                <summary>162330326 徐紫阳</summary>
                <small>网页、界面设计及接口设计</small>
            </details>
            <details>
                <summary>162330327 周梓健</summary>
                <small>数据库数据导入模块，用户管理模块</small>
            </details>
            <details>
                <summary>162330328 卜浩男</summary>
                <small>可靠性分析模型模块，性能分析对比模块</small>
            </details>
        </div>
    </aside>
    <main class="main">
        <div class="top-banner">
            <img src="https://i.imgs.ovh/2025/12/02/C8I3xp.png" alt="平台横幅" />
        </div>
        <header class="header">
            <h2>JM 模型</h2>
            <div id="userDisplay">用户：demo</div>
        </header>
        <section class="content">
            <div class="tabs">
                <div class="tab active" data-tab="intro">模型简介</div>
                <div class="tab" data-tab="failure">失效数据</div>
                <div class="tab" data-tab="forecast">预测分析</div>
            </div>
            <div class="model-panel active" data-model="jm">
                <div class="tab-content active" data-tab="intro">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">JM 模型简介</h3>
                        <p style="line-height:1.8; margin-bottom:10px;">
                            JM 模型（Jelinski–Moranda 模型）是软件可靠性领域的重要经典模型之一，
                            主要用于描述软件在调试排错阶段的错误检测过程，属于“出生模型”（Born-In 模型），
                            适用于浴盆曲线中的早期故障期，即失效率随调试进展逐步递减的阶段。
                        </p>
                        <p style="line-height:1.8; margin-bottom:10px;">
                            在该阶段，软件中遗留的错误较多、易被发现，且每次修复引入新错误的概率较低，
                            因此可以用 JM 模型对有限实测失效数据进行近似建模与可靠性评估，给出平均失效时间间隔、
                            可靠度函数等指标。
                        </p>
                        <h4 style="margin:12px 0 6px; color:var(--primary-dark);">应用与局限性</h4>
                        <p style="line-height:1.8; margin-bottom:8px;">
                            工程实践中，JM 模型因物理意义明确、形式简单，常被用于有限样本条件下的软件可靠性近似评估；
                            后续研究还结合程序员技能、测试条件等环境因素对模型参数进行修正，以提高预测精度。
                        </p>
                        <p style="line-height:1.8; margin-bottom:8px;">
                            但该模型主要针对调试阶段，对运行期的恒定失效率或后期递增失效率刻画能力有限，
                            因此不适合直接描述软件全生命周期的可靠性变化过程。
                        </p>
                        <h4 style="margin:12px 0 6px; color:var(--primary-dark);">模型假设</h4>
                        <ol style="padding-left:20px; line-height:1.8; margin-bottom:10px;">
                            <li>软件中固有初始错误个数 \(N_0\) 为一个未知常数；</li>
                            <li>软件中的各个错误相互独立，每个错误导致系统失效的可能性大致相同，各次失效时间间隔亦相互独立；</li>
                            <li>测试过程中错误一旦被检测出即被完全排除，每次排错只排除一个错误，排错时间可忽略，且不引入新的错误；</li>
                            <li>软件的失效率在每个失效间隔内为常数，其数值正比于当前软件中残留的错误数，比例系数为 \(\varphi\)；</li>
                            <li>软件的实际运行方式与预期运行方式相似。</li>
                        </ol>
                        <h4 style="margin:12px 0 6px; color:var(--primary-dark);">模型基本公式</h4>
                        <div style="margin:8px 0 14px;">
                            <img src="https://i.imgs.ovh/2025/12/02/Cey8hX.png" alt="JM 模型基本公式一" style="max-width:100%; display:block; margin-bottom:8px;">
                            <img src="https://i.imgs.ovh/2025/12/02/CeyWHp.png" alt="JM 模型基本公式二" style="max-width:100%; display:block;">
                        </div>
                        <h4 style="margin:12px 0 6px; color:var(--primary-dark);">使用方式（本系统中的实现）</h4>
                        <p style="line-height:1.8; margin-bottom:4px;">
                            1）选择数据导入方式（直接输入或数据库导入）：
                        </p>
                        <ul style="padding-left:20px; line-height:1.8; margin-bottom:6px;">
                            <li><strong>直接输入：</strong>指定失效数据个数，并以空格分隔的形式输入各失效时间间隔；</li>
                            <li><strong>数据库导入：</strong>配置数据库连接参数，从失效数据表中自动读取失效时间序列。</li>
                        </ul>
                        <p style="line-height:1.8;">
                            2）系统根据所选数据和参数，对 JM 模型进行参数估计与拟合，输出可靠度函数、MTBF 等指标，
                            并在“失效数据”“预测分析”页面中给出相应的曲线与结果表格。
                        </p>
                    </div>
                </div>
                <div class="tab-content" data-tab="failure">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">失效数据输入</h3>
                        <div style="margin-bottom:20px;">
                            <label style="display:block; margin-bottom:8px; font-weight:bold;">数据输入方式</label>
                            <select id="jm-data-type" style="width:200px;">
                                <option value="direct">直接输入</option>
                                <option value="csv">CSV文件导入</option>
                                <option value="database">数据库导入</option>
                            </select>
                        </div>

                        <!-- 直接输入区域 -->
                        <div id="jm-direct-input" style="display:block;">
                            <div class="form-row">
                                <label>失效间隔时间序列（空格分隔，例如：1.0 2.0 3.0 4.0）</label>
                                <textarea id="jm-intervals-input" rows="4" placeholder="请输入失效间隔时间，空格分隔，例如：1.0 2.0 3.0 4.0" style="width:100%; padding:10px; border:1px solid #c7d6f3; border-radius:4px; font-family:monospace;"></textarea>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="jm-load-direct">加载数据</button>
                            </div>
                        </div>

                        <!-- CSV文件导入区域 -->
                        <div id="jm-csv-input" style="display:none;">
                            <div class="form-row">
                                <label>选择CSV文件</label>
                                <input type="file" id="jm-csv-file" accept=".csv" style="width:100%; padding:8px; border:1px solid #c7d6f3; border-radius:4px;" />
                                <small style="color:#666; font-size:12px; margin-top:4px; display:block;">
                                    CSV文件格式：每行一个失效时间间隔数值（例如：9, 12, 11, 4, 7...）<br>
                                    示例文件位置：repos/JM/JM/data.csv
                                </small>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="jm-load-csv">从CSV文件加载</button>
                            </div>
                        </div>

                        <!-- 数据库导入区域 -->
                        <div id="jm-db-input" style="display:none;">
                            <div class="form-row">
                                <label>数据库主机</label>
                                <input type="text" id="jm-db-host" placeholder="localhost" value="localhost" />
                            </div>
                            <div class="form-row">
                                <label>用户名</label>
                                <input type="text" id="jm-db-user" placeholder="root" value="root" />
                            </div>
                            <div class="form-row">
                                <label>密码</label>
                                <input type="password" id="jm-db-password" placeholder="请输入密码" />
                            </div>
                            <div class="form-row">
                                <label>数据库名</label>
                                <input type="text" id="jm-db-database" placeholder="jm" value="jm" />
                            </div>
                            <div class="form-row">
                                <label>表名</label>
                                <input type="text" id="jm-db-table" placeholder="timi" value="timi" />
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="jm-load-db">从数据库加载</button>
                            </div>
                        </div>

                        <!-- 数据展示区域 -->
                        <div id="jm-data-display" style="display:none; margin-top:20px; padding-top:20px; border-top:1px solid #d9e2f3;">
                            <h4 style="color:var(--primary-dark); margin-bottom:12px;">数据统计</h4>
                            <div class="stats-row" id="jm-stats">
                                <div>数据长度：<strong id="jm-data-length">-</strong></div>
                                <div>数据总和：<strong id="jm-data-sum">-</strong></div>
                                <div>平均值：<strong id="jm-data-mean">-</strong></div>
                                <div>最小值：<strong id="jm-data-min">-</strong></div>
                                <div>最大值：<strong id="jm-data-max">-</strong></div>
                            </div>
                            <h4 style="color:var(--primary-dark); margin-top:16px; margin-bottom:12px;">数据预览</h4>
                            <div style="max-height:300px; overflow-y:auto;">
                                <table id="jm-data-table">
                                    <thead>
                                        <tr>
                                            <th>序号</th>
                                            <th>失效间隔时间</th>
                                        </tr>
                                    </thead>
                                    <tbody id="jm-data-tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="jm-data-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                    </div>
                </div>
                <div class="tab-content" data-tab="forecast">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">分析设置</h3>
                        <div class="form-row">
                            <label>精度参数 ex (默认: 1e-6)</label>
                            <input type="number" id="jm-ex" placeholder="1e-6" step="1e-7" value="0.000001" />
                            <small style="color:#666; font-size:12px;">设置范围: 0-1。用于N0求解的精度控制</small>
                        </div>
                        <div class="form-row">
                            <label>精度参数 ey (默认: 1e-6)</label>
                            <input type="number" id="jm-ey" placeholder="1e-6" step="1e-7" value="0.000001" />
                            <small style="color:#666; font-size:12px;">设置范围: 0-1。用于N0求解的精度控制</small>
                        </div>
                        <div class="actions">
                            <button class="btn secondary" id="jm-reset-params">重置</button>
                            <button class="btn primary" id="jm-analyze-btn">开始分析</button>
                        </div>

                        <!-- 分析结果区域 -->
                        <div id="jm-results" style="display:none; margin-top:30px; padding-top:20px; border-top:2px solid var(--primary-light);">
                            <h3 style="margin-bottom:15px; color:var(--primary-dark);">分析结果</h3>
                            
                            <!-- 参数估计结果 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">参数估计</h4>
                                <div class="stats-row">
                                    <div class="stat-card">
                                        <h4>初始故障数 N₀</h4>
                                        <p id="jm-result-n0">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>故障检测率 φ</h4>
                                        <p id="jm-result-phi">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>平均 MTBF</h4>
                                        <p id="jm-result-mtbf">-</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 误差评估指标 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">误差评估</h4>
                                <div class="stats-row">
                                    <div class="stat-card">
                                        <h4>MAE</h4>
                                        <p id="jm-result-mae">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>RMSE</h4>
                                        <p id="jm-result-rmse">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>R²</h4>
                                        <p id="jm-result-r2">-</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 图表区域 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">可视化图表</h4>
                                <!-- Matplotlib生成的图表（优先显示） -->
                                <div id="jm-matplotlib-chart" style="display:none; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa; text-align:center;">
                                    <img id="jm-chart-image" src="" alt="JM模型分析图表" style="max-width:100%; height:auto; border-radius:4px;" />
                                </div>
                                <!-- Chart.js图表（备用，如果matplotlib不可用） -->
                                <div id="jm-chart-container" style="display:none; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa;">
                                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                                        <div>
                                            <h5 style="color:var(--primary-dark); margin-bottom:10px; text-align:center;">观测值 vs 预测值对比</h5>
                                            <canvas id="jm-prediction-chart" style="max-height:300px;"></canvas>
                                        </div>
                                        <div>
                                            <h5 style="color:var(--primary-dark); margin-bottom:10px; text-align:center;">失效率 λ(t) 曲线</h5>
                                            <canvas id="jm-failure-rate-chart" style="max-height:300px;"></canvas>
                                        </div>
                                    </div>
                                    <div style="margin-top:20px;">
                                        <h5 style="color:var(--primary-dark); margin-bottom:10px; text-align:center;">可靠度函数 R(t) 曲线</h5>
                                        <canvas id="jm-reliability-chart" style="max-height:300px;"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- 预测结果表格 -->
                            <div>
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">预测结果对比</h4>
                                <div style="max-height:300px; overflow-y:auto;">
                                    <table id="jm-prediction-table">
                                        <thead>
                                            <tr>
                                                <th>序号</th>
                                                <th>观测值</th>
                                                <th>预测值</th>
                                                <th>误差</th>
                                            </tr>
                                        </thead>
                                        <tbody id="jm-prediction-tbody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="jm-analyze-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                        <div id="jm-analyze-loading" style="display:none; text-align:center; padding:20px; color:#666;">
                            <p>正在分析中，请稍候...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="model-panel" data-model="go">
                <div class="tab-content" data-tab="intro">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">GO 模型简介</h3>
                        <div style="line-height:1.8;">
                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">一、模型简介</h4>
                            <p style="margin-bottom:15px;">
                                GO 模型是一种图形化、定量化的系统可靠性分析方法，由美国贝尔实验室于 20 世纪 60 年代提出，最初用于硬件系统可靠性评估，后逐步扩展至软件、软硬件混合系统。其核心思想是：
                            </p>
                            <ul style="margin-left:20px; margin-bottom:15px;">
                                <li>以 "系统成功完成任务" 为分析目标，而非聚焦 "故障发生"；</li>
                                <li>将系统分解为若干功能单元（组件），用标准化的图形符号（GO 图）描述组件间的逻辑关系（串联、并联、表决等）；</li>
                                <li>通过数学计算（概率传递、状态组合）推导系统整体的成功概率（即可靠度）。</li>
                            </ul>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">二、应用与局限性</h4>
                            <p style="margin-bottom:10px;"><strong>应用场景：</strong></p>
                            <ul style="margin-left:20px; margin-bottom:15px;">
                                <li><strong>嵌入式软件：</strong>如航空航天控制软件、汽车电子软件（需高可靠性，任务流程明确）；</li>
                                <li><strong>分布式系统/集群软件：</strong>如服务器集群、云存储系统（含主备切换、表决机制）；</li>
                                <li><strong>流程化软件：</strong>如工业控制软件、金融交易系统（任务步骤固定，组件逻辑清晰）；</li>
                                <li><strong>软硬件混合系统：</strong>如物联网设备固件（需同时考虑硬件组件和软件模块的可靠性）。</li>
                            </ul>
                            <p style="margin-bottom:15px;">
                                <strong>局限性：</strong>软件模块的 "功能边界" 不如硬件组件清晰（如函数调用、数据依赖），导致系统分解难度大；标准GO模型的17种操作符难以覆盖软件特有的逻辑（如循环、分支、异常处理）；软件组件的成功概率难以通过试验直接测量（硬件可通过寿命试验获取），需依赖历史数据或专家评估，主观性强。
                            </p>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">三、模型假设</h4>
                            <ol style="margin-left:20px; margin-bottom:15px;">
                                <li>程序在同实际执行环境相差不大的条件下执行。</li>
                                <li>在软件测试过程中，所有检测到的故障是相互独立的。</li>
                                <li>测试未运行时的软件失效为0；当测试进行时，软件失效服从均值为m(t)的非齐次泊松过程（NHPP）。</li>
                                <li>t 时刻累积检测到的故障数量m(t)变化率与当前剩余的故障数量a − m(t)成正比例, 比例系数为b。</li>
                                <li>每次只修正一个错误，当软件故障出现时，引发故障的错误被立即排除，并不会引入新的错误。</li>
                            </ol>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">四、模型基本公式</h4>
                            <div style="margin-bottom:20px;">
                                <img src="https://i.imgs.ovh/2025/12/02/Ceynw6.png" alt="GO模型公式1" style="max-width:100%; height:auto; margin-bottom:10px; display:block;" />
                                <img src="https://i.imgs.ovh/2025/12/02/CeyHLO.png" alt="GO模型公式2" style="max-width:100%; height:auto; margin-bottom:10px; display:block;" />
                                <img src="https://i.imgs.ovh/2025/12/02/CeyJMd.png" alt="GO模型公式3" style="max-width:100%; height:auto; margin-bottom:10px; display:block;" />
                            </div>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">五、使用方式</h4>
                            <p style="margin-bottom:10px;">选择数据的导入方式：直接输入、数据库导入</p>
                            <ol style="margin-left:20px;">
                                <li><strong>直接输入：</strong>输入失效数据个数，输入失效数据的发生时间（空格分隔）</li>
                                <li><strong>数据库导入：</strong>连接数据库，导入数据</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="tab-content" data-tab="failure">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">失效数据输入</h3>
                        <div style="margin-bottom:20px;">
                            <label style="display:block; margin-bottom:8px; font-weight:bold;">数据输入方式</label>
                            <select id="go-data-type" style="width:200px;">
                                <option value="direct">直接输入</option>
                                <option value="csv">CSV文件导入</option>
                                <option value="database">数据库导入</option>
                            </select>
                        </div>

                        <!-- 直接输入区域 -->
                        <div id="go-direct-input" style="display:block;">
                            <div class="form-row">
                                <label>失效发生时间序列（空格分隔，例如：1.0 2.5 5.0 10.0）</label>
                                <small style="color:#666; font-size:12px;">注意：GO模型输入的是失效发生的绝对时间（递增），不是间隔时间。数据需满足：平均失效时间 < 最后失效时间的一半</small>
                                <textarea id="go-times-input" rows="4" placeholder="请输入失效发生时间，空格分隔，例如：1.0 2.5 5.0 10.0" style="width:100%; padding:10px; border:1px solid #c7d6f3; border-radius:4px; font-family:monospace; margin-top:6px;"></textarea>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="go-load-direct">加载数据</button>
                            </div>
                        </div>

                        <!-- CSV文件导入区域 -->
                        <div id="go-csv-input" style="display:none;">
                            <div class="form-row">
                                <label>选择CSV文件</label>
                                <input type="file" id="go-csv-file" accept=".csv" style="width:100%; padding:8px; border:1px solid #c7d6f3; border-radius:4px;" />
                                <small style="color:#666; font-size:12px; margin-top:4px; display:block;">
                                    CSV文件格式：每行一个失效发生时间数值（累计时间，例如：0, 9, 21, 32, 36...）<br>
                                    示例文件位置：repos/GO/GO/data.csv
                                </small>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="go-load-csv">从CSV文件加载</button>
                            </div>
                        </div>

                        <!-- 数据库导入区域 -->
                        <div id="go-db-input" style="display:none;">
                            <div class="form-row">
                                <label>数据库主机</label>
                                <input type="text" id="go-db-host" placeholder="localhost" value="localhost" />
                            </div>
                            <div class="form-row">
                                <label>用户名</label>
                                <input type="text" id="go-db-user" placeholder="root" value="root" />
                            </div>
                            <div class="form-row">
                                <label>密码</label>
                                <input type="password" id="go-db-password" placeholder="请输入密码" />
                            </div>
                            <div class="form-row">
                                <label>数据库名</label>
                                <input type="text" id="go-db-database" placeholder="go" value="go" />
                            </div>
                            <div class="form-row">
                                <label>表名</label>
                                <input type="text" id="go-db-table" placeholder="timi" value="timi" />
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="go-load-db">从数据库加载</button>
                            </div>
                        </div>

                        <!-- 数据展示区域 -->
                        <div id="go-data-display" style="display:none; margin-top:20px; padding-top:20px; border-top:1px solid #d9e2f3;">
                            <h4 style="color:var(--primary-dark); margin-bottom:12px;">数据统计</h4>
                            <div class="stats-row" id="go-stats">
                                <div>数据长度：<strong id="go-data-length">-</strong></div>
                                <div>最后失效时间 tN：<strong id="go-data-tn">-</strong></div>
                                <div>最小值：<strong id="go-data-min">-</strong></div>
                                <div>最大值：<strong id="go-data-max">-</strong></div>
                                <div>平均值：<strong id="go-data-mean">-</strong></div>
                            </div>
                            <h4 style="color:var(--primary-dark); margin-top:16px; margin-bottom:12px;">数据预览</h4>
                            <div style="max-height:300px; overflow-y:auto;">
                                <table id="go-data-table">
                                    <thead>
                                        <tr>
                                            <th>序号</th>
                                            <th>失效发生时间</th>
                                        </tr>
                                    </thead>
                                    <tbody id="go-data-tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="go-data-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                    </div>
                </div>
                <div class="tab-content" data-tab="forecast">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">分析设置</h3>
                        <div class="form-row">
                            <label>示例时间 t（用于计算可靠度 R(t)，可选）</label>
                            <input type="number" id="go-t-example" placeholder="例如：10.0" step="0.1" />
                            <small style="color:#666; font-size:12px;">设置一个时间点，计算该时刻的可靠度</small>
                        </div>
                        <div class="actions">
                            <button class="btn secondary" id="go-reset-params">重置</button>
                            <button class="btn primary" id="go-analyze-btn">开始分析</button>
                        </div>

                        <!-- 分析结果区域 -->
                        <div id="go-results" style="display:none; margin-top:30px; padding-top:20px; border-top:2px solid var(--primary-light);">
                            <h3 style="margin-bottom:15px; color:var(--primary-dark);">分析结果</h3>
                            
                            <!-- 参数估计结果 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">参数估计</h4>
                                <div class="stats-row">
                                    <div class="stat-card">
                                        <h4>初始故障数 a</h4>
                                        <p id="go-result-a">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>故障检测率 b</h4>
                                        <p id="go-result-b">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>参数 D</h4>
                                        <p id="go-result-d">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>最后失效时间 tN</h4>
                                        <p id="go-result-tn">-</p>
                                    </div>
                                </div>
                                <div id="go-example-reliability" style="display:none; margin-top:12px; padding:10px; background:#f0f6f6; border-radius:4px;">
                                    <strong>示例可靠度：</strong>当 t = <span id="go-example-t">-</span> 时，R(t) = <span id="go-example-r">-</span>
                                </div>
                            </div>

                            <!-- 误差评估指标 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">误差评估</h4>
                                <div class="stats-row">
                                    <div class="stat-card">
                                        <h4>MAE</h4>
                                        <p id="go-result-mae">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>RMSE</h4>
                                        <p id="go-result-rmse">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>R²</h4>
                                        <p id="go-result-r2">-</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 图表区域 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">可视化图表</h4>
                                <!-- Matplotlib生成的图表（优先显示） -->
                                <div id="go-matplotlib-chart" style="display:none; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa; text-align:center;">
                                    <img id="go-chart-image" src="" alt="GO模型分析图表" style="max-width:100%; height:auto; border-radius:4px;" />
                                </div>
                                <!-- Chart.js图表（备用） -->
                                <div id="go-chart-container" style="display:none; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa;">
                                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                                        <div>
                                            <h5 style="color:var(--primary-dark); margin-bottom:10px; text-align:center;">累计故障数：真实 vs 预测</h5>
                                            <canvas id="go-prediction-chart" style="max-height:300px;"></canvas>
                                        </div>
                                        <div>
                                            <h5 style="color:var(--primary-dark); margin-bottom:10px; text-align:center;">可靠度函数 R(t) 曲线</h5>
                                            <canvas id="go-reliability-chart" style="max-height:300px;"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 预测结果表格 -->
                            <div>
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">预测结果对比</h4>
                                <div style="max-height:300px; overflow-y:auto;">
                                    <table id="go-prediction-table">
                                        <thead>
                                            <tr>
                                                <th>时间 t</th>
                                                <th>真实累计故障数</th>
                                                <th>预测累计故障数</th>
                                                <th>误差</th>
                                            </tr>
                                        </thead>
                                        <tbody id="go-prediction-tbody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="go-analyze-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                        <div id="go-analyze-loading" style="display:none; text-align:center; padding:20px; color:#666;">
                            <p>正在分析中，请稍候...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="model-panel" data-model="markov">
                <div class="tab-content" data-tab="intro">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">基于Markov的SOA可靠性分析</h3>
                        <div style="line-height:1.8;">
                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">一、模型简介</h4>
                            <p style="margin-bottom:15px;">
                                基于马尔可夫链的SOA（面向服务的架构）可靠性分析模型，将整个SOA系统抽象为一系列离散的状态（如：服务正常运行、服务降级、服务故障、备份服务激活等），并通过计算状态间的转移概率来动态评估系统的整体可靠性、可用性及平均无故障时间等指标。
                            </p>
                            <p style="margin-bottom:15px;">
                                它认为系统的未来状态仅取决于当前状态，而与过去状态无关（马尔可夫性），这非常适合于描述由网络、硬件、软件故障及恢复行为构成的随机过程。
                            </p>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">二、应用与局限性</h4>
                            <p style="margin-bottom:10px;"><strong>应用场景：</strong></p>
                            <ul style="margin-left:20px; margin-bottom:15px;">
                                <li><strong>复杂依赖关系：</strong>服务间存在调用、并行、异步或冗余关系。马尔可夫链可以清晰刻画一个服务故障如何通过级联影响其他服务。</li>
                                <li><strong>动态重配置与冗余：</strong>系统具备故障转移、服务降级或动态重路由机制。例如：主节点故障后，系统以一定概率（或延迟）成功切换到备用节点。马尔可夫链可以建模这个切换过程及其成功率。</li>
                                <li><strong>修复与恢复过程：</strong>可以建模维修人员到达时间、软件重启时间等修复行为，分析其对可用性的影响。</li>
                                <li><strong>组合服务可靠性评估：</strong>对于由多个原子服务编排而成的组合服务（如BPEL流程），马尔可夫链可以综合考虑所有可能故障路径，计算流程的整体可靠性。</li>
                            </ul>
                            <p style="margin-bottom:15px;">
                                <strong>局限性：</strong>
                            </p>
                            <ul style="margin-left:20px; margin-bottom:15px;">
                                <li><strong>状态空间爆炸：</strong>这是最核心的局限性。对于一个由 n 个独立组件组成的系统，最坏情况下可能产生 2^n 个状态（每个组件都有正常/故障两种状态）。对于大型SOA系统（数十上百个服务），状态数量将变得极其庞大，难以建模和求解。</li>
                                <li><strong>马尔可夫性假设：</strong>模型假设未来状态只与当前状态有关。这要求组件的故障率和修复率必须是常数（服从指数分布），或者至少是时间无关的。然而现实中，软件可能存在与时间相关的错误（如内存泄漏），硬件可能存在磨损期，这违反了指数分布假设。</li>
                                <li><strong>忽略共因故障：</strong>标准模型通常假设组件故障是相互独立的。但实际上，SOA系统中的服务可能因共享同一物理服务器、虚拟机、网络链路或底层库，而导致共因故障。忽略这一点会高估系统可靠性。</li>
                                <li><strong>可维护性差：</strong>当SOA架构发生变更（如增加一个新服务或改变调用关系）时，整个马尔可夫模型可能需要重构，状态转移图也需要重新设计，维护成本高。</li>
                            </ul>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">三、SOA模型假设</h4>
                            <ol style="margin-left:20px; margin-bottom:15px;">
                                <li>软件错误检出率与剩余错误数成正比，是随时间变化的函数D(t), 0 &lt; D(t) &lt; 1</li>
                                <li>错误引入率与已经检出的错误数成正比，是随时间变化的函数I(t), 0 &lt; I(t) &lt; 1</li>
                                <li>每次软件的失效是由一个软件错误引起，当失效发生后，错误排除需要时间，错误排除率表示为随时间变化的函数φ(t), 0 &lt; φ(t) ≤ 1</li>
                                <li>累积错误数[N(t), t&gt;0]的期望函数m(t) = E[N(t)]是一个独立的单调递增函数,且N(0)=0，服从Poisson分布，且lim N(t)=A，其中A为N₀和新引入的错误数之和。</li>
                            </ol>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">四、模型思路</h4>
                            <ol style="margin-left:20px; margin-bottom:15px;">
                                <li>设置n个服务，每个服务含各自的可靠度</li>
                                <li>设置状态转移矩阵，连接这n个服务，每个服务转移到其他服务的概率和为1，可自环，输出状态转移图</li>
                                <li>设置服务的初始分布概率（和为1），采用稳态分析方法求解稳态方程得到稳态分布和系统可靠度</li>
                                <li>通过广度优先搜索实现路径连通以计算路径可靠度</li>
                            </ol>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">五、使用方法</h4>
                            <p style="margin-bottom:10px;">（1）选择输入方式</p>
                            <ul style="margin-left:20px; margin-bottom:15px;">
                                <li><strong>手动输入：</strong>输入每个服务的名称和可靠度；输入状态转移矩阵；输入初始状态分布；设置终止服务</li>
                                <li><strong>数据库加载系统：</strong>从数据库加载已保存的系统配置</li>
                            </ul>
                            <p style="margin-bottom:10px;">（2）得出系统可靠度</p>
                            <p style="margin-bottom:10px;">（3）输入起始终止服务，计算路径可靠度</p>
                            <p style="margin-bottom:10px;">（4）导出可视化状态转移图</p>
                        </div>
                    </div>
                </div>
                <div class="tab-content" data-tab="failure">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">服务配置输入</h3>
                        <p style="margin-bottom:15px; color:#666; font-size:14px;">
                            Markov模型需要配置服务信息（名称、可靠度）和状态转移概率。支持直接输入或从数据库导入。
                        </p>
                        
                        <!-- 数据输入方式选择 -->
                        <div class="form-row" style="margin-bottom:20px;">
                            <label>数据输入方式</label>
                            <select id="markov-input-type" style="width:100%; padding:8px; border:1px solid #c7d6f3; border-radius:4px;">
                                <option value="direct">直接输入</option>
                                <option value="database">数据库导入</option>
                            </select>
                        </div>
                        
                        <!-- 直接输入区域 -->
                        <div id="markov-direct-input">
                            <h4 style="color:var(--primary-dark); margin:20px 0 10px;">服务配置</h4>
                            <div id="markov-services-container">
                                <!-- 动态添加的服务输入框 -->
                            </div>
                            <button type="button" class="btn secondary" id="markov-add-service" style="margin-top:10px;">添加服务</button>
                            
                            <h4 style="color:var(--primary-dark); margin:20px 0 10px;">状态转移概率</h4>
                            <div id="markov-transitions-container">
                                <!-- 动态添加的转移概率输入框 -->
                            </div>
                            <button type="button" class="btn secondary" id="markov-add-transition" style="margin-top:10px;">添加转移</button>
                            
                            <div class="actions" style="margin-top:20px;">
                                <button class="btn primary" id="markov-load-direct">加载配置</button>
                            </div>
                        </div>
                        
                        <!-- 数据库导入区域 -->
                        <div id="markov-database-input" style="display:none;">
                            <div class="form-row">
                                <label>数据库主机</label>
                                <input type="text" id="markov-db-host" placeholder="localhost" value="localhost" />
                            </div>
                            <div class="form-row">
                                <label>数据库用户名</label>
                                <input type="text" id="markov-db-user" placeholder="root" value="root" />
                            </div>
                            <div class="form-row">
                                <label>数据库密码</label>
                                <input type="password" id="markov-db-password" placeholder="数据库密码" />
                            </div>
                            <div class="form-row">
                                <label>数据库名称</label>
                                <input type="text" id="markov-db-database" placeholder="markov" value="markov" />
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="markov-load-database">从数据库导入</button>
                            </div>
                        </div>
                        
                        <!-- 配置展示区域 -->
                        <div id="markov-config-display" style="display:none; margin-top:30px; padding-top:20px; border-top:2px solid var(--primary-light);">
                            <h4 style="color:var(--primary-dark); margin-bottom:12px;">当前配置</h4>
                            <div id="markov-config-content"></div>
                        </div>
                        
                        <div id="markov-data-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                    </div>
                </div>
                <div class="tab-content" data-tab="forecast">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">分析设置</h3>
                        
                        <div class="form-row">
                            <label>初始状态分布（可选，空格或逗号分隔，如：0.5 0.5 或 0.6,0.4）</label>
                            <small style="color:#666; font-size:12px;">注意：如果提供，所有值的和必须等于1。留空则使用均匀分布。</small>
                            <input type="text" id="markov-initial-dist" placeholder="例如：0.5 0.5 或留空使用均匀分布" style="width:100%; padding:10px; border:1px solid #c7d6f3; border-radius:4px; margin-top:6px;" />
                        </div>
                        
                        <div class="form-row">
                            <label>终止状态（可选，多个用逗号分隔）</label>
                            <small style="color:#666; font-size:12px;">指定哪些服务是终止状态，用于计算整体可靠度。</small>
                            <input type="text" id="markov-terminal-states" placeholder="例如：EndService,FinalService" style="width:100%; padding:10px; border:1px solid #c7d6f3; border-radius:4px; margin-top:6px;" />
                        </div>
                        
                        <div class="actions">
                            <button class="btn secondary" id="markov-reset-params">重置</button>
                            <button class="btn primary" id="markov-analyze-btn">开始分析</button>
                        </div>
                        
                        <!-- 分析结果区域 -->
                        <div id="markov-results" style="display:none; margin-top:30px; padding-top:20px; border-top:2px solid var(--primary-light);">
                            <h3 style="margin-bottom:15px; color:var(--primary-dark);">分析结果</h3>
                            
                            <!-- 整体可靠度 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">整体系统可靠度</h4>
                                <div class="stat-card" style="max-width:300px;">
                                    <h4>整体可靠度</h4>
                                    <p id="markov-result-reliability" style="font-size:24px; font-weight:bold;">-</p>
                                </div>
                            </div>
                            
                            <!-- 服务详情和稳态概率（合并显示） -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">服务详情与稳态概率</h4>
                                <div style="max-height:300px; overflow-y:auto;">
                                    <table id="markov-services-table">
                                        <thead>
                                            <tr>
                                                <th>服务名称</th>
                                                <th>服务可靠度</th>
                                                <th>稳态概率</th>
                                            </tr>
                                        </thead>
                                        <tbody id="markov-services-tbody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- 状态转移矩阵（简化显示） -->
                            <div>
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">状态转移矩阵</h4>
                                <div style="max-height:300px; overflow-y:auto;">
                                    <table id="markov-matrix-table">
                                        <thead id="markov-matrix-thead">
                                        </thead>
                                        <tbody id="markov-matrix-tbody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <div id="markov-analyze-loading" style="display:none; text-align:center; margin-top:20px; color:var(--primary-dark);">
                            <p>正在分析，请稍候...</p>
                        </div>
                        <div id="markov-analyze-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                    </div>
                </div>
            </div>

            <div class="model-panel" data-model="emd">
                <div class="tab-content" data-tab="intro">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">经验模态分解模型简介</h3>
                        <div style="line-height:1.8;">
                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">一、模型简介</h4>
                            <p style="margin-bottom:15px;">
                                经验模态分解（Empirical Mode Decomposition，EMD）是一种自适应的时频分析方法，由美国国家宇航局（NASA）的黄锷（Norden E. Huang）等人于 1998 年提出，专门用于处理非线性、非平稳信号，弥补了傅里叶变换、小波变换等传统方法在非平稳信号分析中的不足。
                            </p>
                            <p style="margin-bottom:15px;">
                                EMD 的核心是将复杂信号分解为若干个本征模函数（Intrinsic Mode Function，IMF）和一个残余分量，EMD分解信号不需要事先预定或强制给定基函数，而是依赖信号本身特征而自适应地进行分解。
                            </p>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">二、应用与局限性</h4>
                            <p style="margin-bottom:10px;">
                                EMD 的自适应性和时频局部性使其成为非线性、非平稳信号分析的关键工具，广泛应用于多个工程与科研领域：机械故障诊断、生物医学信号处理、电力系统信号分析、图像处理等。
                            </p>
                            <p style="margin-bottom:15px;">
                                EMD缺乏严格的数学理论支撑，存在以下局限性：
                            </p>
                            <ul style="margin-left:20px; margin-bottom:15px;">
                                <li><strong>端点效应：</strong>三次样条插值拟合包络线时，信号两端的极值点数量有限，无法准确外推，导致包络线在端点处失真，进而影响整个 IMF 分量的精度，且误差会随着分解迭代传递到后续分量；</li>
                                <li><strong>对噪声敏感：</strong>原始信号中的噪声会被当作高频成分分解为 IMF 分量，甚至诱发额外的虚假 IMF，掩盖真实的信号特征；</li>
                                <li><strong>计算效率较低：</strong>迭代筛选过程需要反复提取极值点、拟合包络线并验证 IMF 条件，当信号长度较长或需要分解的分量较多时，计算量会显著增加。</li>
                            </ul>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">三、模型假设</h4>
                            <ol style="margin-left:20px; margin-bottom:15px;">
                                <li>信号至少有两个极值点，一个极大值和一个极小值；</li>
                                <li>特征时间尺度通过两个极值点之间的时间定义；</li>
                                <li>若数据缺乏极值点但有形变点，则可通过数据微分一次或几次获得极值点，然后再通过积分来获得分解结果。</li>
                            </ol>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">四、模型过程/算法</h4>
                            <ol style="margin-left:20px; margin-bottom:15px;">
                                <li>根据原始信号上下极值点，分别画出上下包络线</li>
                                <li>求上下包络线的均值，画出均值包络线</li>
                                <li>原始信号减均值包络线，得到中间信号</li>
                                <li>判断该中间信号是否满足IMF的两个条件，如果满足，该信号就是一个IMF分量；如果不是，以该信号为基础，重新做①~④的分析。IMF分量的获取通常需要若干次的迭代。</li>
                                <li>使用上述方法得到第一个IMF后，用原始信号减IMF1，作为新的原始信号，再通过①~④的分析，可以得到IMF2，以此类推，完成EMD分解。</li>
                            </ol>
                            <p style="margin-bottom:10px;"><strong>IMF的两个条件：</strong></p>
                            <ul style="margin-left:20px; margin-bottom:15px;">
                                <li>在整个数据范围内，局部极值点和过零点的数目必须相等，或者相差数目最多为1。</li>
                                <li>在任意时刻，局部最大值的包络（上包络线）和局部最小值的包络（下包络线）的平均值必须为零。</li>
                            </ul>
                            <div style="margin:20px 0;">
                                <img src="https://i.imgs.ovh/2025/12/07/CPyLkg.png" alt="EMD算法流程图" style="max-width:100%; height:auto; display:block; border:1px solid #d9e2f3; border-radius:4px;" />
                                <p style="text-align:center; color:#666; font-size:12px; margin-top:8px;">图：EMD算法流程图</p>
                            </div>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">五、EMD-SVR&GM模型流程图</h4>
                            <div style="margin:20px 0;">
                                <img src="https://i.imgs.ovh/2025/12/07/CPyT40.png" alt="EMD-SVR&GM模型流程图" style="max-width:100%; height:auto; display:block; border:1px solid #d9e2f3; border-radius:4px;" />
                                <p style="text-align:center; color:#666; font-size:12px; margin-top:8px;">图：EMD-SVR&GM模型流程图</p>
                            </div>

                            <h4 style="color:var(--primary-dark); margin-top:20px; margin-bottom:10px;">六、使用方法</h4>
                            <p style="margin-bottom:10px;">选择数据的导入方式：直接输入、CSV文件导入、数据库导入</p>
                            <ol style="margin-left:20px;">
                                <li><strong>直接输入：</strong>输入失效数据个数，输入失效数据的时间间隔（空格分隔）</li>
                                <li><strong>CSV文件导入：</strong>输入CSV文件路径，导入数据</li>
                                <li><strong>数据库导入：</strong>连接数据库，导入数据</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="tab-content" data-tab="failure">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">失效数据输入</h3>
                        
                        <!-- 数据输入方式 -->
                        <div class="form-row" style="margin-bottom:20px;">
                            <label>数据输入方式</label>
                            <select id="emd-input-type" style="width:100%; padding:8px; border:1px solid #c7d6f3; border-radius:4px;">
                                <option value="direct">直接输入</option>
                                <option value="csv">CSV文件导入</option>
                                <option value="database">数据库导入</option>
                            </select>
                        </div>
                        
                        <!-- 直接输入区域 -->
                        <div id="emd-direct-input">
                            <div class="form-row">
                                <label>失效时间间隔序列（空格分隔，例如：9 12 11 4 7 2 5 8）</label>
                                <small style="color:#666; font-size:12px;">注意：EMD模型输入的是失效时间间隔序列</small>
                                <textarea id="emd-intervals-input" rows="4" placeholder="请输入失效时间间隔，空格分隔，例如：9 12 11 4 7 2 5 8" style="width:100%; padding:10px; border:1px solid #c7d6f3; border-radius:4px; font-family:monospace; margin-top:6px;"></textarea>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="emd-load-direct">加载数据</button>
                            </div>
                        </div>
                        
                        <!-- CSV文件导入区域 -->
                        <div id="emd-csv-input" style="display:none;">
                            <div class="form-row">
                                <label>选择CSV文件</label>
                                <input type="file" id="emd-csv-file" accept=".csv" style="width:100%; padding:8px; border:1px solid #c7d6f3; border-radius:4px;" />
                                <small style="color:#666; font-size:12px; margin-top:4px; display:block;">
                                    CSV文件格式：每行一个失效时间间隔数值（例如：9, 12, 11, 4, 7...）<br>
                                    示例文件位置：repos/经验模态分解/经验模态分解/data.csv
                                </small>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="emd-load-csv">从CSV文件加载</button>
                            </div>
                        </div>

                        <!-- 数据库导入区域 -->
                        <div id="emd-database-input" style="display:none;">
                            <div class="form-row">
                                <label>数据库主机</label>
                                <input type="text" id="emd-db-host" placeholder="localhost" value="localhost" />
                            </div>
                            <div class="form-row">
                                <label>数据库用户名</label>
                                <input type="text" id="emd-db-user" placeholder="root" value="root" />
                            </div>
                            <div class="form-row">
                                <label>数据库密码</label>
                                <input type="password" id="emd-db-password" placeholder="数据库密码" />
                            </div>
                            <div class="form-row">
                                <label>数据库名称</label>
                                <input type="text" id="emd-db-database" placeholder="emd" value="emd" />
                            </div>
                            <div class="form-row">
                                <label>表名</label>
                                <input type="text" id="emd-db-table" placeholder="timi" value="timi" />
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="emd-load-database">从数据库导入</button>
                            </div>
                        </div>

                        <!-- 数据展示区域 -->
                        <div id="emd-data-display" style="display:none; margin-top:20px; padding-top:20px; border-top:1px solid #d9e2f3;">
                            <h4 style="color:var(--primary-dark); margin-bottom:12px;">数据统计</h4>
                            <div class="stats-row" id="emd-stats">
                                <div>数据长度：<strong id="emd-data-length">-</strong></div>
                                <div>数据总和：<strong id="emd-data-sum">-</strong></div>
                                <div>平均值：<strong id="emd-data-mean">-</strong></div>
                                <div>最小值：<strong id="emd-data-min">-</strong></div>
                                <div>最大值：<strong id="emd-data-max">-</strong></div>
                            </div>
                            <h4 style="color:var(--primary-dark); margin-top:16px; margin-bottom:12px;">数据预览</h4>
                            <div style="max-height:300px; overflow-y:auto;">
                                <table id="emd-data-table">
                                    <thead>
                                        <tr>
                                            <th>序号</th>
                                            <th>失效时间间隔</th>
                                        </tr>
                                    </thead>
                                    <tbody id="emd-data-tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="emd-data-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                    </div>
                </div>
                <div class="tab-content" data-tab="forecast">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">分析设置</h3>
                        <div class="form-row">
                            <label>最大IMF数量 (max_imf)</label>
                            <input type="number" id="emd-max-imf" placeholder="6" value="6" min="1" max="20" />
                            <small style="color:#666; font-size:12px;">设置范围: 1-20。EMD分解的最大IMF层数</small>
                        </div>
                        <div class="form-row">
                            <label>SVR滞后步数 (svr_lags)</label>
                            <input type="number" id="emd-svr-lags" placeholder="3" value="3" min="1" max="10" />
                            <small style="color:#666; font-size:12px;">设置范围: 1-10。用于SVR预测的滞后窗口大小</small>
                        </div>
                        <div class="form-row">
                            <label>SVR参数 C</label>
                            <input type="number" id="emd-svr-c" placeholder="1.0" value="1.0" step="0.1" min="0.1" />
                            <small style="color:#666; font-size:12px;">SVR的惩罚参数C</small>
                        </div>
                        <div class="form-row">
                            <label>SVR参数 epsilon</label>
                            <input type="number" id="emd-svr-epsilon" placeholder="0.05" value="0.05" step="0.01" min="0.01" />
                            <small style="color:#666; font-size:12px;">SVR的epsilon参数</small>
                        </div>
                        <div class="form-row">
                            <label>SVR核函数 (kernel)</label>
                            <select id="emd-svr-kernel">
                                <option value="rbf">RBF (径向基函数)</option>
                                <option value="linear">Linear (线性)</option>
                                <option value="poly">Polynomial (多项式)</option>
                                <option value="sigmoid">Sigmoid</option>
                            </select>
                        </div>
                        <div class="actions">
                            <button class="btn secondary" id="emd-reset-params">重置</button>
                            <button class="btn primary" id="emd-analyze-btn">开始分析</button>
                        </div>

                        <!-- 分析结果区域 -->
                        <div id="emd-results" style="display:none; margin-top:30px; padding-top:20px; border-top:2px solid var(--primary-light);">
                            <h3 style="margin-bottom:15px; color:var(--primary-dark);">分析结果</h3>
                            
                            <!-- 参数信息 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">模型参数</h4>
                                <div class="stats-row">
                                    <div class="stat-card">
                                        <h4>IMF数量</h4>
                                        <p id="emd-result-imf-count">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>最大IMF</h4>
                                        <p id="emd-result-max-imf">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>SVR滞后步数</h4>
                                        <p id="emd-result-svr-lags">-</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 误差评估指标 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">误差评估</h4>
                                <div class="stats-row">
                                    <div class="stat-card">
                                        <h4>MAE</h4>
                                        <p id="emd-result-mae">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>RMSE</h4>
                                        <p id="emd-result-rmse">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>MSE</h4>
                                        <p id="emd-result-mse">-</p>
                                    </div>
                                    <div class="stat-card">
                                        <h4>MAPE (%)</h4>
                                        <p id="emd-result-mape">-</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 图表区域 -->
                            <div style="margin-bottom:20px;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">可视化图表</h4>
                                <!-- Matplotlib生成的图表（优先显示） -->
                                <div id="emd-matplotlib-chart" style="display:none; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa; text-align:center;">
                                    <img id="emd-chart-image" src="" alt="EMD模型分析图表" style="max-width:100%; height:auto; border-radius:4px;" />
                                </div>
                                <!-- Chart.js图表（备用） -->
                                <div id="emd-chart-container" style="display:none; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa;">
                                    <div>
                                        <h5 style="color:var(--primary-dark); margin-bottom:10px; text-align:center;">实际值 vs 预测值对比</h5>
                                        <canvas id="emd-prediction-chart" style="max-height:400px;"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- 预测结果表格 -->
                            <div>
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">预测结果对比</h4>
                                <div style="max-height:300px; overflow-y:auto;">
                                    <table id="emd-prediction-table">
                                        <thead>
                                            <tr>
                                                <th>序号</th>
                                                <th>实际值</th>
                                                <th>预测值</th>
                                                <th>误差</th>
                                            </tr>
                                        </thead>
                                        <tbody id="emd-prediction-tbody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="emd-analyze-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                        <div id="emd-analyze-loading" style="display:none; text-align:center; padding:20px; color:#666;">
                            <p>正在分析中，请稍候（EMD分解和SVR训练可能需要一些时间）...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="model-panel" data-model="perf_compare">
                <div class="tab-content active" data-tab="intro">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">性能对比分析</h3>
                        <p style="margin-bottom:15px; color:#666; font-size:14px;">
                            对比JM、GO、EMD三个模型的性能指标（MAE、RMSE、R²、耗时）。支持直接输入或从数据库导入失效时间间隔数据。
                        </p>
                        
                        <!-- 数据输入方式 -->
                        <div class="form-row" style="margin-bottom:20px;">
                            <label>数据输入方式</label>
                            <select id="perf-input-type" style="width:100%; padding:8px; border:1px solid #c7d6f3; border-radius:4px;">
                                <option value="direct">直接输入</option>
                                <option value="csv">CSV文件导入</option>
                                <option value="database">数据库导入</option>
                            </select>
                        </div>
                        
                        <!-- 直接输入区域 -->
                        <div id="perf-direct-input">
                            <div class="form-row">
                                <label>失效时间间隔序列（空格分隔，例如：1.0 2.0 3.0 4.0）</label>
                                <textarea id="perf-intervals-input" rows="4" placeholder="请输入失效时间间隔，空格分隔" style="width:100%; padding:10px; border:1px solid #c7d6f3; border-radius:4px; font-family:monospace;"></textarea>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="perf-analyze-btn">开始对比分析</button>
                            </div>
                        </div>
                        
                        <!-- CSV文件导入区域 -->
                        <div id="perf-csv-input" style="display:none;">
                            <div class="form-row">
                                <label>选择CSV文件</label>
                                <input type="file" id="perf-csv-file" accept=".csv" style="width:100%; padding:8px; border:1px solid #c7d6f3; border-radius:4px;" />
                                <small style="color:#666; font-size:12px; margin-top:4px; display:block;">
                                    CSV文件格式：每行一个失效时间间隔数值（例如：9, 12, 11, 4, 7...）<br>
                                    示例文件位置：repos/性能对比分析/性能对比分析/data.csv
                                </small>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="perf-analyze-csv-btn">开始对比分析</button>
                            </div>
                        </div>

                        <!-- 数据库导入区域 -->
                        <div id="perf-database-input" style="display:none;">
                            <div class="form-row">
                                <label>数据库主机</label>
                                <input type="text" id="perf-db-host" placeholder="localhost" value="localhost" />
                            </div>
                            <div class="form-row">
                                <label>数据库用户名</label>
                                <input type="text" id="perf-db-user" placeholder="root" value="root" />
                            </div>
                            <div class="form-row">
                                <label>数据库密码</label>
                                <input type="password" id="perf-db-password" placeholder="数据库密码" />
                            </div>
                            <div class="form-row">
                                <label>数据库名称</label>
                                <input type="text" id="perf-db-database" placeholder="compare" value="compare" />
                            </div>
                            <div class="form-row">
                                <label>表名</label>
                                <input type="text" id="perf-db-table" placeholder="timi" value="timi" />
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="perf-analyze-db-btn">开始对比分析</button>
                            </div>
                        </div>
                        
                        <!-- 结果展示区域 -->
                        <div id="perf-results" style="display:none; margin-top:30px; padding-top:20px; border-top:2px solid var(--primary-light);">
                            <h3 style="margin-bottom:15px; color:var(--primary-dark);">对比结果</h3>
                            
                            <!-- 结果表格 -->
                            <div style="margin-bottom:20px;">
                                <table id="perf-results-table">
                                    <thead>
                                        <tr>
                                            <th>模型</th>
                                            <th>MAE</th>
                                            <th>RMSE</th>
                                            <th>R²</th>
                                            <th>耗时(s)</th>
                                            <th>状态</th>
                                        </tr>
                                    </thead>
                                    <tbody id="perf-results-tbody">
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- 图表区域 -->
                            <!-- Matplotlib生成的图表（优先显示） -->
                            <div id="perf-matplotlib-chart" style="display:none; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa; text-align:center;">
                                <img id="perf-chart-image" src="" alt="性能对比分析图表" style="max-width:100%; height:auto; border-radius:4px;" />
                            </div>
                            <!-- Chart.js图表（备用） -->
                            <div id="perf-chart-container" style="display:none; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">性能指标对比图表</h4>
                                <canvas id="perf-comparison-chart" style="max-height:400px;"></canvas>
                            </div>
                        </div>
                        
                        <div id="perf-analyze-loading" style="display:none; text-align:center; margin-top:20px; color:var(--primary-dark);">
                            <p>正在分析，请稍候...</p>
                        </div>
                        <div id="perf-analyze-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                    </div>
                </div>
            </div>

            <div class="model-panel" data-model="slr_compare">
                <div class="tab-content" data-tab="intro">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">SLR 对比分析</h3>
                        <p style="line-height:1.8; margin-bottom:15px;">
                            SLR（Software Level Reliability）对比分析模块用于将实验结果与系统级可靠性或文献基准进行对照，
                            形成更加全面的评估结论。对比JM、GO、EMD三个模型的综合性能指标（MSE、RMSE、MAE、MAPE、R²、耗时）。
                        </p>
                        <p style="line-height:1.8; color:#666; font-size:14px;">
                            支持直接输入或从数据库导入失效时间间隔数据，系统将自动运行三个模型并生成详细的对比报告。
                        </p>
                    </div>
                </div>
                <div class="tab-content" data-tab="failure">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">数据输入</h3>
                        <p style="margin-bottom:15px; color:#666; font-size:14px;">
                            输入失效时间间隔数据，系统将自动运行JM、GO、EMD三个模型进行对比分析。
                        </p>
                        
                        <!-- 数据输入方式 -->
                        <div class="form-row" style="margin-bottom:20px;">
                            <label>数据输入方式</label>
                            <select id="slr-input-type" style="width:100%; padding:8px; border:1px solid #c7d6f3; border-radius:4px;">
                                <option value="direct">直接输入</option>
                                <option value="csv">CSV文件导入</option>
                                <option value="database">数据库导入</option>
                            </select>
                        </div>
                        
                        <!-- 直接输入区域 -->
                        <div id="slr-direct-input">
                            <div class="form-row">
                                <label>失效时间间隔序列（空格分隔，例如：9 12 11 4 7 2 5 8）</label>
                                <textarea id="slr-intervals-input" rows="4" placeholder="请输入失效时间间隔，空格分隔" style="width:100%; padding:10px; border:1px solid #c7d6f3; border-radius:4px; font-family:monospace;"></textarea>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="slr-analyze-btn">开始SLR对比分析</button>
                            </div>
                        </div>
                        
                        <!-- CSV文件导入区域 -->
                        <div id="slr-csv-input" style="display:none;">
                            <div class="form-row">
                                <label>选择CSV文件</label>
                                <input type="file" id="slr-csv-file" accept=".csv" style="width:100%; padding:8px; border:1px solid #c7d6f3; border-radius:4px;" />
                                <small style="color:#666; font-size:12px; margin-top:4px; display:block;">
                                    CSV文件格式：每行一个失效时间间隔数值（例如：9, 12, 11, 4, 7...）<br>
                                    示例文件位置：repos/SLR对比分析/SLR对比分析/data.csv
                                </small>
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="slr-analyze-csv-btn">开始SLR对比分析</button>
                            </div>
                        </div>

                        <!-- 数据库导入区域 -->
                        <div id="slr-database-input" style="display:none;">
                            <div class="form-row">
                                <label>数据库主机</label>
                                <input type="text" id="slr-db-host" placeholder="localhost" value="localhost" />
                            </div>
                            <div class="form-row">
                                <label>数据库用户名</label>
                                <input type="text" id="slr-db-user" placeholder="root" value="root" />
                            </div>
                            <div class="form-row">
                                <label>数据库密码</label>
                                <input type="password" id="slr-db-password" placeholder="数据库密码" />
                            </div>
                            <div class="form-row">
                                <label>数据库名称</label>
                                <input type="text" id="slr-db-database" placeholder="slr" value="slr" />
                            </div>
                            <div class="form-row">
                                <label>表名</label>
                                <input type="text" id="slr-db-table" placeholder="timi" value="timi" />
                            </div>
                            <div class="actions">
                                <button class="btn primary" id="slr-analyze-db-btn">开始SLR对比分析</button>
                            </div>
                        </div>
                        
                        <div id="slr-data-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                    </div>
                </div>
                <div class="tab-content" data-tab="forecast">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">SLR 对比结果</h3>
                        
                        <!-- 数据统计 -->
                        <div id="slr-data-stats" style="display:none; margin-bottom:20px; padding:15px; background:#f0f6f6; border-radius:4px;">
                            <h4 style="color:var(--primary-dark); margin-bottom:10px;">数据统计</h4>
                            <div class="stats-row" id="slr-stats-content">
                            </div>
                        </div>
                        
                        <!-- 对比结果表格 -->
                        <div id="slr-results" style="display:none; margin-top:20px;">
                            <h4 style="color:var(--primary-dark); margin-bottom:10px;">模型性能对比表</h4>
                            <div style="max-height:400px; overflow-y:auto; margin-bottom:20px;">
                                <table id="slr-results-table">
                                    <thead>
                                        <tr>
                                            <th>模型</th>
                                            <th>MSE</th>
                                            <th>RMSE</th>
                                            <th>MAE</th>
                                            <th>MAPE(%)</th>
                                            <th>R²</th>
                                            <th>耗时(s)</th>
                                            <th>状态</th>
                                        </tr>
                                    </thead>
                                    <tbody id="slr-results-tbody">
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- 最佳模型推荐 -->
                            <div id="slr-best-models" style="margin-top:20px; padding:15px; background:#e6f7ed; border-radius:4px; border:1px solid #2d8659;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">最佳模型推荐</h4>
                                <div id="slr-best-models-content">
                                </div>
                            </div>
                            
                            <!-- 图表区域 -->
                            <!-- Matplotlib生成的图表（优先显示） -->
                            <div id="slr-matplotlib-chart" style="display:none; margin-top:20px; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa; text-align:center;">
                                <img id="slr-chart-image" src="" alt="SLR对比分析图表" style="max-width:100%; height:auto; border-radius:4px;" />
                            </div>
                            <!-- Chart.js图表（备用） -->
                            <div id="slr-chart-container" style="display:none; margin-top:20px; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">预测值对比图表</h4>
                                <canvas id="slr-prediction-chart" style="max-height:400px;"></canvas>
                            </div>
                            
                            <!-- 性能指标对比图表 -->
                            <div id="slr-metrics-chart-container" style="display:none; margin-top:20px; border:1px solid #d9e2f3; border-radius:4px; padding:16px; background:#fafafa;">
                                <h4 style="color:var(--primary-dark); margin-bottom:10px;">性能指标对比图表</h4>
                                <canvas id="slr-metrics-chart" style="max-height:400px;"></canvas>
                            </div>
                        </div>
                        
                        <div id="slr-analyze-loading" style="display:none; text-align:center; margin-top:20px; color:var(--primary-dark);">
                            <p>正在分析，请稍候...</p>
                        </div>
                        <div id="slr-analyze-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                    </div>
                </div>
            </div>

            <div class="model-panel" data-model="user_mgmt">
                <div class="tab-content active" data-tab="intro">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">用户管理</h3>
                        <p style="line-height:1.8;">
                            系统管理模块中的用户管理用于维护平台账号，包括新增用户、重置密码、更新用户信息等基础功能。
                            用户数据存储在MySQL数据库的user_db.sys_user表中。
                        </p>
                        <p style="line-height:1.8; margin-top:10px;">
                            <strong>数据库配置：</strong>如需连接其他数据库，请在"用户列表"页面配置数据库连接参数。
                        </p>
                    </div>
                </div>
                <div class="tab-content" data-tab="failure">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">用户列表</h3>
                        
                        <!-- 数据库配置区域 -->
                        <div style="margin-bottom:20px; padding:15px; background:#f0f6f6; border-radius:4px; border:1px solid #d9e2f3;">
                            <h4 style="color:var(--primary-dark); margin-bottom:10px;">数据库配置（必填）</h4>
                            <p style="font-size:12px; color:#666; margin-bottom:10px;">请输入数据库连接信息以查看和管理用户数据。默认配置：localhost/root/空密码/user_db</p>
                            <div class="filter-row">
                                <div>
                                    <label>主机</label>
                                    <input type="text" id="user-db-host" placeholder="localhost" value="localhost" />
                                </div>
                                <div>
                                    <label>用户名</label>
                                    <input type="text" id="user-db-user" placeholder="root" value="root" />
                                </div>
                                <div>
                                    <label>密码</label>
                                    <input type="password" id="user-db-password" placeholder="数据库密码" />
                                </div>
                                <div>
                                    <label>数据库</label>
                                    <input type="text" id="user-db-database" placeholder="user_db" value="user_db" />
                                </div>
                            </div>
                        </div>
                        
                        <!-- 搜索和分页 -->
                        <div class="filter-row" style="margin-bottom:15px;">
                            <div style="flex:1;">
                                <input type="text" id="user-search-input" placeholder="搜索用户名..." style="width:100%; padding:8px;" />
                            </div>
                            <button class="btn secondary" id="user-search-btn">搜索</button>
                            <button class="btn primary" id="user-refresh-btn">刷新</button>
                        </div>
                        
                        <!-- 用户表格 -->
                        <div style="max-height:400px; overflow-y:auto;">
                            <table id="user-list-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>用户名</th>
                                        <th>手机号</th>
                                        <th>邮箱</th>
                                        <th>创建时间</th>
                                        <th>最后登录</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="user-list-tbody">
                                    <tr>
                                        <td colspan="7" style="text-align:center; padding:20px; color:#666;">点击"刷新"按钮加载用户列表</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 分页信息 -->
                        <div id="user-pagination" style="margin-top:15px; text-align:center; color:#666; display:none;">
                            <span id="user-page-info">第 1 页，共 0 条</span>
                            <button class="btn secondary" id="user-prev-btn" style="margin-left:15px;">上一页</button>
                            <button class="btn secondary" id="user-next-btn" style="margin-left:10px;">下一页</button>
                        </div>
                        
                        <div id="user-list-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                    </div>
                </div>
                <div class="tab-content" data-tab="forecast">
                    <div class="card">
                        <h3 style="margin-bottom:15px; color:var(--primary-dark);">新增/编辑用户</h3>
                        <input type="hidden" id="user-edit-id" />
                        <div class="form-row">
                            <label>用户名 <span style="color:#c7393d;">*</span></label>
                            <input type="text" id="user-edit-username" placeholder="请输入用户名（必填）" />
                        </div>
                        <div class="form-row">
                            <label>密码 <span style="color:#c7393d;">*</span></label>
                            <input type="password" id="user-edit-password" placeholder="请输入密码（必填，新增用户时）" />
                            <small style="color:#666; font-size:12px; margin-top:4px;">编辑用户时，留空则不修改密码</small>
                        </div>
                        <div class="form-row">
                            <label>手机号</label>
                            <input type="text" id="user-edit-phone" placeholder="请输入手机号（可选）" />
                        </div>
                        <div class="form-row">
                            <label>邮箱</label>
                            <input type="email" id="user-edit-email" placeholder="请输入邮箱（可选）" />
                        </div>
                        <div class="actions">
                            <button class="btn secondary" id="user-edit-clear">清空</button>
                            <button class="btn primary" id="user-edit-save">保存用户</button>
                        </div>
                        <div id="user-edit-error" style="display:none; color:#c7393d; margin-top:12px; padding:10px; background:#ffe6e6; border-radius:4px;"></div>
                        <div id="user-edit-success" style="display:none; color:#2d8659; margin-top:12px; padding:10px; background:#e6f7ed; border-radius:4px;"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    </div>
    <script>
        const sidebarItems = document.querySelectorAll('.menu-item[data-model]');
        const headerTitle = document.querySelector('.header h2');
        const userDisplay = document.getElementById('userDisplay');
        const modelPanels = document.querySelectorAll('.model-panel');
        const tabButtons = document.querySelectorAll('.tab');
        const tabLabels = {
            default: ['模型简介', '失效数据', '预测分析'],
            jm: ['模型简介', '失效数据', '预测分析'],
            go: ['模型简介', '失效数据', '预测分析'],
            emd: ['模型简介', '失效数据', '预测分析'],
            markov: ['模型简介', '失效数据', '预测分析'],
            perf_compare: ['性能对比分析'],
            slr_compare: ['概览', '数据输入', '对比结果'],
            user_mgmt: ['模块说明', '用户列表', '账号维护']
        };
        let currentModel = 'jm';
        let currentTab = 'intro';

        function updateTabLabels() {
            const labels = tabLabels[currentModel] || tabLabels.default;
            tabButtons.forEach((btn, idx) => {
                btn.textContent = labels[idx] || '';
                btn.style.visibility = labels[idx] ? 'visible' : 'hidden';
            });
        }

        function updatePanels() {
            updateTabLabels();
            modelPanels.forEach(panel => {
                const isActiveModel = panel.dataset.model === currentModel;
                panel.classList.toggle('active', isActiveModel);
                if (isActiveModel) {
                    const tabContents = panel.querySelectorAll('.tab-content');
                    tabContents.forEach(content => {
                        content.classList.toggle('active', content.dataset.tab === currentTab);
                    });
                }
            });
        }

        sidebarItems.forEach(item => {
            item.addEventListener('click', () => {
                sidebarItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                currentModel = item.dataset.model;
                headerTitle.textContent = item.textContent.trim();
                updatePanels();
            });
        });

        tabButtons.forEach(tabBtn => {
            tabBtn.addEventListener('click', () => {
                tabButtons.forEach(t => t.classList.remove('active'));
                tabBtn.classList.add('active');
                currentTab = tabBtn.dataset.tab;
                updatePanels();
            });
        });

        updatePanels();

        const loginBtn = document.getElementById('loginBtn');
        const loginScreen = document.getElementById('loginScreen');
        const appContainer = document.getElementById('appContainer');
        const loginError = document.getElementById('loginError');
        const logoutItem = document.getElementById('logoutItem');
        const loginUserInput = document.getElementById('loginUser');
        const loginPassInput = document.getElementById('loginPass');

        function resetToDefaultView() {
            currentModel = 'jm';
            currentTab = 'intro';
            sidebarItems.forEach(item => {
                if (item.dataset && item.dataset.model) {
                    item.classList.toggle('active', item.dataset.model === currentModel);
                }
            });
            tabButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === currentTab);
            });
            updatePanels();
        }

        loginBtn.addEventListener('click', async () => {
            const user = loginUserInput.value.trim();
            const pass = loginPassInput.value;
            
            if (!user || !pass) {
                loginError.textContent = '请输入用户名和密码';
                return;
            }
            
            try {
                // 获取数据库配置（如果用户填写了，则使用用户配置；否则使用默认配置）
                const dbHost = document.getElementById('loginDbHost')?.value.trim() || 'localhost';
                const dbUser = document.getElementById('loginDbUser')?.value.trim() || 'root';
                const dbPassword = document.getElementById('loginDbPassword')?.value || '';
                const dbDatabase = document.getElementById('loginDbDatabase')?.value.trim() || 'user_db';
                
                const requestBody = {
                    username: user,
                    password: pass
                };
                
                // 如果用户修改了数据库配置，则发送配置；否则使用后端默认配置
                if (dbHost !== 'localhost' || dbUser !== 'root' || dbPassword || dbDatabase !== 'user_db') {
                    requestBody.db_config = {
                        host: dbHost,
                        user: dbUser,
                        password: dbPassword,
                        database: dbDatabase
                    };
                }
                
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                const result = await response.json();
                
                if (result.success && result.user) {
                    loginScreen.style.display = 'none';
                    appContainer.classList.remove('hidden');
                    loginError.textContent = '';
                    resetToDefaultView();
                    if (userDisplay) {
                        userDisplay.textContent = `用户：${result.user.username}`;
                    }
                    // 保存当前用户信息
                    window.currentUser = result.user;
                    
                    // 如果有警告信息（数据库未配置），显示提示
                    if (result.warning) {
                        setTimeout(() => {
                            alert(result.warning);
                        }, 500);
                    }
                } else {
                    loginError.textContent = result.error || '账户或密码不正确，请重试';
                    // 如果错误信息较长，调整样式
                    if (result.error && result.error.length > 50) {
                        loginError.style.fontSize = '12px';
                        loginError.style.lineHeight = '1.5';
                    }
                }
            } catch (error) {
                // 更详细的错误信息
                let errorMsg = '登录失败，请检查后端服务是否启动';
                if (error.message) {
                    if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError') || error.message.includes('ERR_CONNECTION_REFUSED')) {
                        errorMsg = `无法连接到后端服务！\n\n当前API地址: ${API_BASE}\n\n请确认：\n1. 后端服务已启动 (运行 python app.py)\n2. 服务运行在端口5000\n3. 浏览器控制台(F12)查看详细错误\n\n提示：如果直接打开HTML文件，请通过 http://localhost:5000/index.html 访问`;
                    } else {
                        errorMsg = `登录失败: ${error.message}`;
                    }
                }
                loginError.textContent = errorMsg;
                loginError.style.whiteSpace = 'pre-line'; // 允许换行显示
                console.error('登录错误:', error);
                console.error('API地址:', API_BASE);
                console.error('错误详情:', error);
                
                // 尝试测试连接
                testBackendConnection().then(connected => {
                    if (!connected) {
                        loginError.textContent += `\n\n后端连接测试失败，请检查服务是否启动`;
                    }
                });
            }
        });
        loginPassInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                loginBtn.click();
            }
        });
        if (logoutItem) {
            logoutItem.addEventListener('click', () => {
                appContainer.classList.add('hidden');
                loginScreen.style.display = 'flex';
                loginUserInput.value = '';
                loginPassInput.value = '';
                loginError.textContent = '';
                if (userDisplay) {
                    userDisplay.textContent = '用户：demo';
                }
            });
        }

        // ========== JM模型相关功能 ==========
        // 自动检测API地址
        const getApiBase = () => {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            
            // 如果通过file://协议打开（直接打开HTML文件），使用localhost
            if (protocol === 'file:' || !hostname || hostname === '') {
                console.warn('检测到file://协议，使用localhost:5000');
                return 'http://localhost:5000';
            }
            
            // 如果是localhost或127.0.0.1，使用localhost
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return 'http://localhost:5000';
            }
            
            // 否则使用当前主机IP（保持协议一致）
            const apiUrl = protocol === 'https:' ? `https://${hostname}:5000` : `http://${hostname}:5000`;
            return apiUrl;
        };
        const API_BASE = getApiBase();
        
        // 在控制台输出API地址，方便调试
        console.log('API地址:', API_BASE);
        console.log('当前页面地址:', window.location.href);
        
        // 测试后端连接
        async function testBackendConnection() {
            try {
                const response = await fetch(`${API_BASE}/health`, {
                    method: 'GET',
                    timeout: 3000
                });
                if (response.ok) {
                    console.log('✓ 后端服务连接成功');
                    return true;
                } else {
                    console.error('✗ 后端服务响应异常:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('✗ 后端服务连接失败:', error.message);
                console.error('请确认：1. 后端服务已启动 (python app.py) 2. 服务运行在端口5000');
                return false;
            }
        }
        
        // 页面加载时测试连接
        window.addEventListener('DOMContentLoaded', () => {
            testBackendConnection();
        });
        let jmCurrentData = null; // 存储当前加载的失效间隔数据
        let jmPredictionChart = null; // Chart.js图表实例
        let jmReliabilityChart = null; // Chart.js图表实例
        let jmFailureRateChart = null; // Chart.js失效率图表实例

        // 数据输入方式切换
        const jmDataTypeSelect = document.getElementById('jm-data-type');
        const jmDirectInput = document.getElementById('jm-direct-input');
        const jmCsvInput = document.getElementById('jm-csv-input');
        const jmDbInput = document.getElementById('jm-db-input');
        
        if (jmDataTypeSelect) {
            jmDataTypeSelect.addEventListener('change', (e) => {
                if (e.target.value === 'direct') {
                    jmDirectInput.style.display = 'block';
                    jmCsvInput.style.display = 'none';
                    jmDbInput.style.display = 'none';
                } else if (e.target.value === 'csv') {
                    jmDirectInput.style.display = 'none';
                    jmCsvInput.style.display = 'block';
                    jmDbInput.style.display = 'none';
                } else {
                    jmDirectInput.style.display = 'none';
                    jmCsvInput.style.display = 'none';
                    jmDbInput.style.display = 'block';
                }
            });
        }

        // CSV文件读取和解析函数（通用，用于单列数据）
        function parseCSVFile(file, callback) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const text = e.target.result;
                    const lines = text.split('\n').filter(line => line.trim() !== '');
                    const data = [];
                    
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        // 跳过表头（如果第一行是表头）
                        if (i === 0 && (line.toLowerCase().includes('interval') || line.toLowerCase().includes('time') || line.toLowerCase().includes('failure') || line.toLowerCase().includes('name'))) {
                            continue;
                        }
                        // 处理CSV格式（可能有逗号分隔）
                        const values = line.split(',').map(v => v.trim()).filter(v => v !== '');
                        for (const val of values) {
                            const num = parseFloat(val);
                            if (!isNaN(num)) {
                                data.push(num);
                            }
                        }
                    }
                    
                    if (data.length === 0) {
                        callback(new Error('CSV文件中没有找到有效数据'));
                        return;
                    }
                    
                    callback(null, data);
                } catch (error) {
                    callback(error);
                }
            };
            reader.onerror = function() {
                callback(new Error('读取文件失败'));
            };
            reader.readAsText(file);
        }

        // JM模型CSV文件加载
        const jmLoadCsvBtn = document.getElementById('jm-load-csv');
        if (jmLoadCsvBtn) {
            jmLoadCsvBtn.addEventListener('click', () => {
                const fileInput = document.getElementById('jm-csv-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    showJmError('请先选择CSV文件');
                    return;
                }
                
                parseCSVFile(file, (error, data) => {
                    if (error) {
                        showJmError('CSV文件导入失败: ' + error.message);
                        return;
                    }
                    
                    // 使用现有的数据加载逻辑
                    jmCurrentData = data;
                    displayJmData(data);
                });
            });
        }

        // 直接输入数据加载
        const jmLoadDirectBtn = document.getElementById('jm-load-direct');
        if (jmLoadDirectBtn) {
            jmLoadDirectBtn.addEventListener('click', () => {
                const inputText = document.getElementById('jm-intervals-input').value.trim();
                if (!inputText) {
                    showJmError('请输入失效间隔时间序列');
                    return;
                }
                const values = inputText.split(/\s+/).map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
                if (values.length === 0) {
                    showJmError('无法解析输入数据，请确保使用空格分隔数字');
                    return;
                }
                jmCurrentData = values;
                displayJmData(values);
            });
        }

        // 数据库导入
        const jmLoadDbBtn = document.getElementById('jm-load-db');
        if (jmLoadDbBtn) {
            jmLoadDbBtn.addEventListener('click', async () => {
                const dbConfig = {
                    host: document.getElementById('jm-db-host').value.trim() || 'localhost',
                    user: document.getElementById('jm-db-user').value.trim() || 'root',
                    password: document.getElementById('jm-db-password').value,
                    database: document.getElementById('jm-db-database').value.trim() || 'jm',
                    table: document.getElementById('jm-db-table').value.trim() || 'timi'
                };
                
                // 显示加载提示
                const errorDiv = document.getElementById('jm-data-error');
                if (errorDiv) {
                    errorDiv.textContent = '正在从数据库导入数据...';
                    errorDiv.style.display = 'block';
                    errorDiv.style.color = '#666';
                    errorDiv.style.background = '#f0f0f0';
                }
                
                try {
                    // 调用仅导入数据接口（不进行分析）
                    const response = await fetch(`${API_BASE}/api/models/jm/import-data`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            db_config: dbConfig
                        })
                    });
                    const result = await response.json();
                    if (result.error) {
                        showJmError(result.error);
                        return;
                    }
                    if (result.success && result.data) {
                        jmCurrentData = result.data;
                        displayJmData(jmCurrentData);
                    } else {
                        showJmError('数据库导入成功，但未返回数据');
                    }
                } catch (error) {
                    showJmError(`数据库导入失败: ${error.message}`);
                }
            });
        }

        // 显示数据
        function displayJmData(data) {
            const displayDiv = document.getElementById('jm-data-display');
            const errorDiv = document.getElementById('jm-data-error');
            if (displayDiv) displayDiv.style.display = 'block';
            if (errorDiv) errorDiv.style.display = 'none';

            // 更新统计信息
            const sum = data.reduce((a, b) => a + b, 0);
            const mean = sum / data.length;
            const min = Math.min(...data);
            const max = Math.max(...data);

            document.getElementById('jm-data-length').textContent = data.length;
            document.getElementById('jm-data-sum').textContent = sum.toFixed(4);
            document.getElementById('jm-data-mean').textContent = mean.toFixed(4);
            document.getElementById('jm-data-min').textContent = min.toFixed(4);
            document.getElementById('jm-data-max').textContent = max.toFixed(4);

            // 更新表格
            const tbody = document.getElementById('jm-data-tbody');
            if (tbody) {
                tbody.innerHTML = '';
                data.forEach((val, idx) => {
                    const row = tbody.insertRow();
                    row.insertCell(0).textContent = idx + 1;
                    row.insertCell(1).textContent = val.toFixed(4);
                });
            }
        }

        function showJmError(msg) {
            const errorDiv = document.getElementById('jm-data-error');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
            }
        }

        // 分析按钮
        const jmAnalyzeBtn = document.getElementById('jm-analyze-btn');
        if (jmAnalyzeBtn) {
            jmAnalyzeBtn.addEventListener('click', async () => {
                if (!jmCurrentData || jmCurrentData.length === 0) {
                    showJmAnalyzeError('请先加载失效数据');
                    return;
                }

                const ex = parseFloat(document.getElementById('jm-ex').value) || 1e-6;
                const ey = parseFloat(document.getElementById('jm-ey').value) || 1e-6;

                const loadingDiv = document.getElementById('jm-analyze-loading');
                const errorDiv = document.getElementById('jm-analyze-error');
                const resultsDiv = document.getElementById('jm-results');

                if (loadingDiv) loadingDiv.style.display = 'block';
                if (errorDiv) errorDiv.style.display = 'none';
                if (resultsDiv) resultsDiv.style.display = 'none';

                try {
                    const response = await fetch(`${API_BASE}/api/models/jm/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            data_type: 'direct',
                            data: jmCurrentData,
                            ex: ex,
                            ey: ey
                        })
                    });

                    const result = await response.json();
                    if (loadingDiv) loadingDiv.style.display = 'none';

                    if (result.error) {
                        showJmAnalyzeError(result.error);
                        return;
                    }

                    if (result.success) {
                        displayJmResults(result);
                        if (resultsDiv) resultsDiv.style.display = 'block';
                    }
                } catch (error) {
                    if (loadingDiv) loadingDiv.style.display = 'none';
                    showJmAnalyzeError(`分析失败: ${error.message}`);
                }
            });
        }

        function displayJmResults(result) {
            // 显示参数估计
            if (result.parameters) {
                document.getElementById('jm-result-n0').textContent = result.parameters.N0.toFixed(4);
                document.getElementById('jm-result-phi').textContent = result.parameters.phi.toFixed(6);
                document.getElementById('jm-result-mtbf').textContent = result.parameters.avg_mtbf.toFixed(4);
            }

            // 显示误差指标
            if (result.metrics) {
                const mae = result.metrics.mae !== null ? result.metrics.mae.toFixed(6) : 'N/A';
                const rmse = result.metrics.rmse !== null ? result.metrics.rmse.toFixed(6) : 'N/A';
                const r2 = result.metrics.r2 !== null ? result.metrics.r2.toFixed(6) : 'N/A';
                document.getElementById('jm-result-mae').textContent = mae;
                document.getElementById('jm-result-rmse').textContent = rmse;
                document.getElementById('jm-result-r2').textContent = r2;
            }

            // 显示预测结果表格
            if (result.predictions) {
                const tbody = document.getElementById('jm-prediction-tbody');
                if (tbody) {
                    tbody.innerHTML = '';
                    const observed = result.predictions.observed || [];
                    const predicted = result.predictions.predicted || [];
                    const indices = result.predictions.indices || [];
                    for (let i = 0; i < observed.length; i++) {
                        const row = tbody.insertRow();
                        row.insertCell(0).textContent = indices[i] || (i + 1);
                        row.insertCell(1).textContent = observed[i].toFixed(4);
                        row.insertCell(2).textContent = predicted[i] ? predicted[i].toFixed(4) : '-';
                        const error = predicted[i] ? (observed[i] - predicted[i]).toFixed(4) : '-';
                        row.insertCell(3).textContent = error;
                    }
                }
            }

            // 优先显示matplotlib生成的图表
            if (result.chart_image) {
                const matplotlibDiv = document.getElementById('jm-matplotlib-chart');
                const chartContainer = document.getElementById('jm-chart-container');
                const chartImg = document.getElementById('jm-chart-image');
                
                if (matplotlibDiv && chartImg) {
                    chartImg.src = 'data:image/png;base64,' + result.chart_image;
                    matplotlibDiv.style.display = 'block';
                    if (chartContainer) chartContainer.style.display = 'none';
                }
            } else {
                // 如果没有matplotlib图表，使用Chart.js
                const matplotlibDiv = document.getElementById('jm-matplotlib-chart');
                const chartContainer = document.getElementById('jm-chart-container');
                if (matplotlibDiv) matplotlibDiv.style.display = 'none';
                if (chartContainer) chartContainer.style.display = 'block';
            }

            // 图表绘制（使用Chart.js，作为备用）
            if (result.predictions && result.reliability_curve && !result.chart_image) {
                // 绘制观测值vs预测值对比图
                const predCtx = document.getElementById('jm-prediction-chart');
                if (predCtx) {
                    // 销毁旧图表（如果存在）
                    if (jmPredictionChart) {
                        jmPredictionChart.destroy();
                    }
                    
                    const observed = result.predictions.observed || [];
                    const predicted = result.predictions.predicted || [];
                    const indices = result.predictions.indices || [];
                    
                    jmPredictionChart = new Chart(predCtx, {
                        type: 'line',
                        data: {
                            labels: indices.map(i => `故障${i}`),
                            datasets: [{
                                label: '观测值',
                                data: observed,
                                borderColor: 'rgb(54, 162, 235)',
                                backgroundColor: 'rgba(54, 162, 235, 0.1)',
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.1
                            }, {
                                label: '预测值',
                                data: predicted,
                                borderColor: 'rgb(255, 99, 132)',
                                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                                borderDash: [5, 5],
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: '故障序号'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: '时间间隔'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }

                // 绘制失效率曲线图（阶梯下降）
                const lambdaCtx = document.getElementById('jm-failure-rate-chart');
                if (lambdaCtx && result.failure_rate_curve) {
                    // 销毁旧图表（如果存在）
                    if (jmFailureRateChart) {
                        jmFailureRateChart.destroy();
                    }
                    
                    const lambdaTimePoints = result.failure_rate_curve.time || [];
                    const lambdaPoints = result.failure_rate_curve.failure_rate || [];
                    
                    jmFailureRateChart = new Chart(lambdaCtx, {
                        type: 'line',
                        data: {
                            labels: lambdaTimePoints.map((t, i) => i % Math.ceil(lambdaTimePoints.length / 8) === 0 ? t.toFixed(2) : ''),
                            datasets: [{
                                label: '失效率 λ(t)',
                                data: lambdaPoints,
                                borderColor: 'rgb(255, 159, 64)',
                                backgroundColor: 'rgba(255, 159, 64, 0.1)',
                                pointRadius: 0,
                                pointHoverRadius: 4,
                                stepped: 'before',  // 阶梯形状：在数据点前保持水平（阶梯下降）
                                tension: 0,
                                fill: false
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        label: function(context) {
                                            return `λ(${lambdaTimePoints[context.dataIndex].toFixed(2)}) = ${context.parsed.y.toFixed(6)}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: '时间 t'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: '失效率 λ(t)'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }

                // 绘制可靠度曲线图
                const relCtx = document.getElementById('jm-reliability-chart');
                if (relCtx) {
                    // 销毁旧图表（如果存在）
                    if (jmReliabilityChart) {
                        jmReliabilityChart.destroy();
                    }
                    
                    const timePoints = result.reliability_curve.time || [];
                    const reliabilityPoints = result.reliability_curve.reliability || [];
                    
                    // 可靠度曲线：在每个间隔内是指数下降，在失效点处有跳跃
                    jmReliabilityChart = new Chart(relCtx, {
                        type: 'line',
                        data: {
                            labels: timePoints.map((t, i) => i % Math.ceil(timePoints.length / 10) === 0 ? t.toFixed(2) : ''),
                            datasets: [{
                                label: '可靠度 R(t)',
                                data: reliabilityPoints,
                                borderColor: 'rgb(75, 192, 192)',
                                backgroundColor: 'rgba(75, 192, 192, 0.1)',
                                pointRadius: 0,
                                pointHoverRadius: 4,
                                tension: 0.1,  // 轻微平滑，显示指数下降
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        label: function(context) {
                                            return `R(${timePoints[context.dataIndex].toFixed(2)}) = ${context.parsed.y.toFixed(4)}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: '时间 t'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: '可靠度 R(t)'
                                    },
                                    min: 0,
                                    max: 1.1
                                }
                            }
                        }
                    });
                }
            }
        }

        function showJmAnalyzeError(msg) {
            const errorDiv = document.getElementById('jm-analyze-error');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
            }
        }

        // 重置参数按钮
        const jmResetBtn = document.getElementById('jm-reset-params');
        if (jmResetBtn) {
            jmResetBtn.addEventListener('click', () => {
                document.getElementById('jm-ex').value = '0.000001';
                document.getElementById('jm-ey').value = '0.000001';
            });
        }

        // ========== GO模型相关功能 ==========
        let goCurrentData = null;
        let goPredictionChart = null;
        let goReliabilityChart = null;

        // 数据输入方式切换
        const goDataTypeSelect = document.getElementById('go-data-type');
        const goDirectInput = document.getElementById('go-direct-input');
        const goCsvInput = document.getElementById('go-csv-input');
        const goDbInput = document.getElementById('go-db-input');
        
        if (goDataTypeSelect) {
            goDataTypeSelect.addEventListener('change', (e) => {
                if (e.target.value === 'direct') {
                    goDirectInput.style.display = 'block';
                    goCsvInput.style.display = 'none';
                    goDbInput.style.display = 'none';
                } else if (e.target.value === 'csv') {
                    goDirectInput.style.display = 'none';
                    goCsvInput.style.display = 'block';
                    goDbInput.style.display = 'none';
                } else {
                    goDirectInput.style.display = 'none';
                    goCsvInput.style.display = 'none';
                    goDbInput.style.display = 'block';
                }
            });
        }

        // GO模型CSV文件加载
        const goLoadCsvBtn = document.getElementById('go-load-csv');
        if (goLoadCsvBtn) {
            goLoadCsvBtn.addEventListener('click', () => {
                const fileInput = document.getElementById('go-csv-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    showGoError('请先选择CSV文件');
                    return;
                }
                
                parseCSVFile(file, (error, data) => {
                    if (error) {
                        showGoError('CSV文件导入失败: ' + error.message);
                        return;
                    }
                    
                    // 使用现有的数据加载逻辑
                    goCurrentData = data;
                    displayGoData(data);
                });
            });
        }

        // 直接输入数据加载
        const goLoadDirectBtn = document.getElementById('go-load-direct');
        if (goLoadDirectBtn) {
            goLoadDirectBtn.addEventListener('click', () => {
                const inputText = document.getElementById('go-times-input').value.trim();
                if (!inputText) {
                    showGoError('请输入失效发生时间序列');
                    return;
                }
                const values = inputText.split(/\s+/).map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
                if (values.length === 0) {
                    showGoError('无法解析输入数据，请确保使用空格分隔数字');
                    return;
                }
                
                // 验证数据是否递增
                for (let i = 1; i < values.length; i++) {
                    if (values[i] <= values[i-1]) {
                        showGoError('失效时间必须按递增顺序排列');
                        return;
                    }
                }
                
                // 验证D值（提前检查是否符合模型要求）
                const N = values.length;
                const tN = values[values.length - 1];
                const sum = values.reduce((a, b) => a + b, 0);
                const D = sum / (N * tN);
                
                if (D >= 0.5) {
                    showGoError(`数据不符合GO模型要求：D = ${D.toFixed(4)} >= 0.5。请确保失效时间分布更分散，平均失效时间应小于最后失效时间的一半。建议：增加数据量或调整时间分布。`);
                    return;
                }
                
                goCurrentData = values;
                displayGoData(values);
            });
        }

        // 数据库导入
        const goLoadDbBtn = document.getElementById('go-load-db');
        if (goLoadDbBtn) {
            goLoadDbBtn.addEventListener('click', async () => {
                const dbConfig = {
                    host: document.getElementById('go-db-host').value.trim() || 'localhost',
                    user: document.getElementById('go-db-user').value.trim() || 'root',
                    password: document.getElementById('go-db-password').value,
                    database: document.getElementById('go-db-database').value.trim() || 'go',
                    table: document.getElementById('go-db-table').value.trim() || 'timi'
                };
                
                const errorDiv = document.getElementById('go-data-error');
                if (errorDiv) {
                    errorDiv.textContent = '正在从数据库导入数据...';
                    errorDiv.style.display = 'block';
                    errorDiv.style.color = '#666';
                    errorDiv.style.background = '#f0f0f0';
                }
                
                try {
                    const response = await fetch(`${API_BASE}/api/models/go/import-data`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ db_config: dbConfig })
                    });
                    const result = await response.json();
                    if (result.error) {
                        showGoError(result.error);
                        return;
                    }
                    if (result.success && result.data) {
                        goCurrentData = result.data;
                        displayGoData(goCurrentData);
                    }
                } catch (error) {
                    showGoError(`数据库导入失败: ${error.message}`);
                }
            });
        }

        function displayGoData(data) {
            const displayDiv = document.getElementById('go-data-display');
            const errorDiv = document.getElementById('go-data-error');
            if (displayDiv) displayDiv.style.display = 'block';
            if (errorDiv) errorDiv.style.display = 'none';

            const sum = data.reduce((a, b) => a + b, 0);
            const mean = sum / data.length;
            const min = Math.min(...data);
            const max = Math.max(...data);
            const tN = data[data.length - 1];

            document.getElementById('go-data-length').textContent = data.length;
            document.getElementById('go-data-tn').textContent = tN.toFixed(4);
            document.getElementById('go-data-mean').textContent = mean.toFixed(4);
            document.getElementById('go-data-min').textContent = min.toFixed(4);
            document.getElementById('go-data-max').textContent = max.toFixed(4);

            const tbody = document.getElementById('go-data-tbody');
            if (tbody) {
                tbody.innerHTML = '';
                data.forEach((val, idx) => {
                    const row = tbody.insertRow();
                    row.insertCell(0).textContent = idx + 1;
                    row.insertCell(1).textContent = val.toFixed(4);
                });
            }
        }

        function showGoError(msg) {
            const errorDiv = document.getElementById('go-data-error');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
                errorDiv.style.color = '#c7393d';
                errorDiv.style.background = '#ffe6e6';
            }
        }

        // GO模型分析按钮
        const goAnalyzeBtn = document.getElementById('go-analyze-btn');
        if (goAnalyzeBtn) {
            goAnalyzeBtn.addEventListener('click', async () => {
                if (!goCurrentData || goCurrentData.length === 0) {
                    showGoAnalyzeError('请先加载失效数据');
                    return;
                }

                const tExample = parseFloat(document.getElementById('go-t-example').value) || null;

                const loadingDiv = document.getElementById('go-analyze-loading');
                const errorDiv = document.getElementById('go-analyze-error');
                const resultsDiv = document.getElementById('go-results');

                if (loadingDiv) loadingDiv.style.display = 'block';
                if (errorDiv) errorDiv.style.display = 'none';
                if (resultsDiv) resultsDiv.style.display = 'none';

                try {
                    const requestBody = {
                        data_type: 'direct',
                        data: goCurrentData
                    };
                    if (tExample !== null) {
                        requestBody.t_example = tExample;
                    }

                    const response = await fetch(`${API_BASE}/api/models/go/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody)
                    });

                    const result = await response.json();
                    if (loadingDiv) loadingDiv.style.display = 'none';

                    if (result.error) {
                        showGoAnalyzeError(result.error);
                        return;
                    }

                    if (result.success) {
                        displayGoResults(result);
                        if (resultsDiv) resultsDiv.style.display = 'block';
                    }
                } catch (error) {
                    if (loadingDiv) loadingDiv.style.display = 'none';
                    showGoAnalyzeError(`分析失败: ${error.message}`);
                }
            });
        }

        function displayGoResults(result) {
            // 优先显示matplotlib生成的图表
            if (result.chart_image) {
                const matplotlibDiv = document.getElementById('go-matplotlib-chart');
                const chartContainer = document.getElementById('go-chart-container');
                const chartImg = document.getElementById('go-chart-image');
                
                if (matplotlibDiv && chartImg) {
                    chartImg.src = 'data:image/png;base64,' + result.chart_image;
                    matplotlibDiv.style.display = 'block';
                    if (chartContainer) chartContainer.style.display = 'none';
                }
            } else {
                const matplotlibDiv = document.getElementById('go-matplotlib-chart');
                const chartContainer = document.getElementById('go-chart-container');
                if (matplotlibDiv) matplotlibDiv.style.display = 'none';
                if (chartContainer) chartContainer.style.display = 'block';
            }
            
            // 显示参数估计
            if (result.parameters) {
                document.getElementById('go-result-a').textContent = result.parameters.a_hat.toFixed(4);
                document.getElementById('go-result-b').textContent = result.parameters.b_hat.toFixed(6);
                document.getElementById('go-result-d').textContent = result.parameters.D.toFixed(6);
                document.getElementById('go-result-tn').textContent = result.parameters.tN.toFixed(4);
            }

            // 显示示例可靠度
            if (result.example_reliability) {
                const exampleDiv = document.getElementById('go-example-reliability');
                if (exampleDiv) {
                    document.getElementById('go-example-t').textContent = result.example_reliability.t.toFixed(2);
                    document.getElementById('go-example-r').textContent = result.example_reliability.R.toFixed(4);
                    exampleDiv.style.display = 'block';
                }
            }

            // 显示误差指标
            if (result.metrics) {
                const mae = result.metrics.mae !== null ? result.metrics.mae.toFixed(6) : 'N/A';
                const rmse = result.metrics.rmse !== null ? result.metrics.rmse.toFixed(6) : 'N/A';
                const r2 = result.metrics.r2 !== null ? result.metrics.r2.toFixed(6) : 'N/A';
                document.getElementById('go-result-mae').textContent = mae;
                document.getElementById('go-result-rmse').textContent = rmse;
                document.getElementById('go-result-r2').textContent = r2;
            }

            // 绘制图表
            if (result.predictions && result.reliability_curve) {
                // 累计故障数对比图
                const predCtx = document.getElementById('go-prediction-chart');
                if (predCtx) {
                    if (goPredictionChart) goPredictionChart.destroy();
                    const timePoints = result.predictions.time || [];
                    const observed = result.predictions.observed || [];
                    const predicted = result.predictions.predicted || [];
                    
                    goPredictionChart = new Chart(predCtx, {
                        type: 'line',
                        data: {
                            labels: timePoints.map((t, i) => i % Math.ceil(timePoints.length / 10) === 0 ? t.toFixed(2) : ''),
                            datasets: [{
                                label: '真实累计故障',
                                data: observed,
                                borderColor: 'rgb(54, 162, 235)',
                                backgroundColor: 'rgba(54, 162, 235, 0.1)',
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }, {
                                label: 'GO模型预测',
                                data: predicted,
                                borderColor: 'rgb(255, 99, 132)',
                                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                                borderDash: [5, 5],
                                pointRadius: 0,
                                pointHoverRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: { display: true, position: 'top' },
                                tooltip: { mode: 'index', intersect: false }
                            },
                            scales: {
                                x: { title: { display: true, text: '时间 t' } },
                                y: { title: { display: true, text: '累计故障数' }, beginAtZero: true }
                            }
                        }
                    });
                }

                // 可靠度曲线图
                const relCtx = document.getElementById('go-reliability-chart');
                if (relCtx) {
                    if (goReliabilityChart) goReliabilityChart.destroy();
                    const timePoints = result.reliability_curve.time || [];
                    const reliabilityPoints = result.reliability_curve.reliability || [];
                    
                    goReliabilityChart = new Chart(relCtx, {
                        type: 'line',
                        data: {
                            labels: timePoints.map((t, i) => i % Math.ceil(timePoints.length / 10) === 0 ? t.toFixed(2) : ''),
                            datasets: [{
                                label: '可靠度 R(t)',
                                data: reliabilityPoints,
                                borderColor: 'rgb(75, 192, 192)',
                                backgroundColor: 'rgba(75, 192, 192, 0.1)',
                                pointRadius: 0,
                                pointHoverRadius: 4,
                                tension: 0.1,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: { display: true, position: 'top' },
                                tooltip: { mode: 'index', intersect: false }
                            },
                            scales: {
                                x: { title: { display: true, text: '时间 t' } },
                                y: { title: { display: true, text: '可靠度 R(t)' }, min: 0, max: 1.1 }
                            }
                        }
                    });
                }
            }

            // 显示预测结果表格
            if (result.predictions) {
                const tbody = document.getElementById('go-prediction-tbody');
                if (tbody) {
                    tbody.innerHTML = '';
                    const timePoints = result.predictions.time || [];
                    const observed = result.predictions.observed || [];
                    const predicted = result.predictions.predicted || [];
                    for (let i = 0; i < observed.length; i++) {
                        const row = tbody.insertRow();
                        row.insertCell(0).textContent = timePoints[i] ? timePoints[i].toFixed(4) : '-';
                        row.insertCell(1).textContent = observed[i].toFixed(4);
                        row.insertCell(2).textContent = predicted[i] ? predicted[i].toFixed(4) : '-';
                        const error = predicted[i] ? (observed[i] - predicted[i]).toFixed(4) : '-';
                        row.insertCell(3).textContent = error;
                    }
                }
            }
        }

        function showGoAnalyzeError(msg) {
            const errorDiv = document.getElementById('go-analyze-error');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
            }
        }

        const goResetBtn = document.getElementById('go-reset-params');
        if (goResetBtn) {
            goResetBtn.addEventListener('click', () => {
                document.getElementById('go-t-example').value = '';
            });
        }

        // ========== EMD模型相关功能 ==========
        let emdCurrentData = null;
        let emdPredictionChart = null;

        // EMD模型数据输入方式切换
        const emdInputType = document.getElementById('emd-input-type');
        const emdDirectInput = document.getElementById('emd-direct-input');
        const emdCsvInput = document.getElementById('emd-csv-input');
        const emdDatabaseInput = document.getElementById('emd-database-input');
        if (emdInputType) {
            emdInputType.addEventListener('change', (e) => {
                if (e.target.value === 'direct') {
                    if (emdDirectInput) emdDirectInput.style.display = 'block';
                    if (emdCsvInput) emdCsvInput.style.display = 'none';
                    if (emdDatabaseInput) emdDatabaseInput.style.display = 'none';
                } else if (e.target.value === 'csv') {
                    if (emdDirectInput) emdDirectInput.style.display = 'none';
                    if (emdCsvInput) emdCsvInput.style.display = 'block';
                    if (emdDatabaseInput) emdDatabaseInput.style.display = 'none';
                } else {
                    if (emdDirectInput) emdDirectInput.style.display = 'none';
                    if (emdCsvInput) emdCsvInput.style.display = 'none';
                    if (emdDatabaseInput) emdDatabaseInput.style.display = 'block';
                }
            });
        }

        // EMD模型CSV文件加载
        const emdLoadCsvBtn = document.getElementById('emd-load-csv');
        if (emdLoadCsvBtn) {
            emdLoadCsvBtn.addEventListener('click', () => {
                const fileInput = document.getElementById('emd-csv-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    showEmdError('请先选择CSV文件');
                    return;
                }
                
                parseCSVFile(file, (error, data) => {
                    if (error) {
                        showEmdError('CSV文件导入失败: ' + error.message);
                        return;
                    }
                    
                    // 使用现有的数据加载逻辑
                    emdCurrentData = data;
                    displayEmdData(data);
                });
            });
        }

        // 直接输入数据加载
        const emdLoadDirectBtn = document.getElementById('emd-load-direct');
        if (emdLoadDirectBtn) {
            emdLoadDirectBtn.addEventListener('click', () => {
                const inputText = document.getElementById('emd-intervals-input').value.trim();
                if (!inputText) {
                    showEmdError('请输入失效时间间隔序列');
                    return;
                }
                const values = inputText.split(/\s+/).map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
                if (values.length === 0) {
                    showEmdError('无法解析输入数据，请确保使用空格分隔数字');
                    return;
                }
                emdCurrentData = values;
                displayEmdData(values);
            });
        }

        // EMD模型数据库导入
        const emdLoadDatabaseBtn = document.getElementById('emd-load-database');
        if (emdLoadDatabaseBtn) {
            emdLoadDatabaseBtn.addEventListener('click', async () => {
                const errorDiv = document.getElementById('emd-data-error');
                
                if (errorDiv) {
                    errorDiv.textContent = '正在从数据库导入数据...';
                    errorDiv.style.display = 'block';
                    errorDiv.style.color = '#666';
                    errorDiv.style.background = '#f0f8ff';
                }
                
                try {
                    const response = await fetch(`${API_BASE}/api/models/emd/import-data`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            db_config: {
                                host: document.getElementById('emd-db-host').value.trim() || 'localhost',
                                user: document.getElementById('emd-db-user').value.trim() || 'root',
                                password: document.getElementById('emd-db-password').value.trim() || '',
                                database: document.getElementById('emd-db-database').value.trim() || 'emd',
                                table: document.getElementById('emd-db-table').value.trim() || 'timi'
                            }
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.error) {
                        showEmdError(`数据库导入失败: ${result.error}`);
                        return;
                    }
                    
                    if (result.success && result.data) {
                        emdCurrentData = result.data;
                        displayEmdData(result.data);
                        if (errorDiv) {
                            errorDiv.style.display = 'none';
                        }
                    } else {
                        showEmdError('数据库导入成功，但未返回数据');
                    }
                } catch (error) {
                    showEmdError(`数据库导入失败: ${error.message}`);
                }
            });
        }

        function displayEmdData(data) {
            const displayDiv = document.getElementById('emd-data-display');
            const errorDiv = document.getElementById('emd-data-error');
            if (displayDiv) displayDiv.style.display = 'block';
            if (errorDiv) errorDiv.style.display = 'none';

            const sum = data.reduce((a, b) => a + b, 0);
            const mean = sum / data.length;
            const min = Math.min(...data);
            const max = Math.max(...data);

            document.getElementById('emd-data-length').textContent = data.length;
            document.getElementById('emd-data-sum').textContent = sum.toFixed(4);
            document.getElementById('emd-data-mean').textContent = mean.toFixed(4);
            document.getElementById('emd-data-min').textContent = min.toFixed(4);
            document.getElementById('emd-data-max').textContent = max.toFixed(4);

            const tbody = document.getElementById('emd-data-tbody');
            if (tbody) {
                tbody.innerHTML = '';
                data.forEach((val, idx) => {
                    const row = tbody.insertRow();
                    row.insertCell(0).textContent = idx + 1;
                    row.insertCell(1).textContent = val.toFixed(4);
                });
            }
        }

        function showEmdError(msg) {
            const errorDiv = document.getElementById('emd-data-error');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
            }
        }

        // EMD模型分析按钮
        const emdAnalyzeBtn = document.getElementById('emd-analyze-btn');
        if (emdAnalyzeBtn) {
            emdAnalyzeBtn.addEventListener('click', async () => {
                if (!emdCurrentData || emdCurrentData.length === 0) {
                    showEmdAnalyzeError('请先加载失效数据');
                    return;
                }

                const maxImf = parseInt(document.getElementById('emd-max-imf').value) || 6;
                const svrLags = parseInt(document.getElementById('emd-svr-lags').value) || 3;
                const svrC = parseFloat(document.getElementById('emd-svr-c').value) || 1.0;
                const svrEpsilon = parseFloat(document.getElementById('emd-svr-epsilon').value) || 0.05;
                const svrKernel = document.getElementById('emd-svr-kernel').value || 'rbf';

                const loadingDiv = document.getElementById('emd-analyze-loading');
                const errorDiv = document.getElementById('emd-analyze-error');
                const resultsDiv = document.getElementById('emd-results');

                if (loadingDiv) loadingDiv.style.display = 'block';
                if (errorDiv) errorDiv.style.display = 'none';
                if (resultsDiv) resultsDiv.style.display = 'none';

                // 判断数据输入方式
                const inputType = document.getElementById('emd-input-type')?.value || 'direct';
                let requestBody = {
                    data_type: inputType,
                    max_imf: maxImf,
                    svr_lags: svrLags,
                    svr_params: {
                        C: svrC,
                        epsilon: svrEpsilon,
                        kernel: svrKernel
                    }
                };
                
                if (inputType === 'direct') {
                    requestBody.data = emdCurrentData;
                } else {
                    requestBody.db_config = {
                        host: document.getElementById('emd-db-host').value.trim() || 'localhost',
                        user: document.getElementById('emd-db-user').value.trim() || 'root',
                        password: document.getElementById('emd-db-password').value.trim() || '',
                        database: document.getElementById('emd-db-database').value.trim() || 'emd',
                        table: document.getElementById('emd-db-table').value.trim() || 'timi'
                    };
                }
                
                try {
                    const response = await fetch(`${API_BASE}/api/models/emd/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody)
                    });

                    const result = await response.json();
                    if (loadingDiv) loadingDiv.style.display = 'none';

                    if (result.error) {
                        showEmdAnalyzeError(result.error);
                        return;
                    }

                    if (result.success) {
                        displayEmdResults(result);
                        if (resultsDiv) resultsDiv.style.display = 'block';
                    }
                } catch (error) {
                    if (loadingDiv) loadingDiv.style.display = 'none';
                    showEmdAnalyzeError(`分析失败: ${error.message}`);
                }
            });
        }

        function displayEmdResults(result) {
            // 优先显示matplotlib生成的图表
            if (result.chart_image) {
                const matplotlibDiv = document.getElementById('emd-matplotlib-chart');
                const chartContainer = document.getElementById('emd-chart-container');
                const chartImg = document.getElementById('emd-chart-image');
                
                if (matplotlibDiv && chartImg) {
                    chartImg.src = 'data:image/png;base64,' + result.chart_image;
                    matplotlibDiv.style.display = 'block';
                    if (chartContainer) chartContainer.style.display = 'none';
                }
            } else {
                const matplotlibDiv = document.getElementById('emd-matplotlib-chart');
                const chartContainer = document.getElementById('emd-chart-container');
                if (matplotlibDiv) matplotlibDiv.style.display = 'none';
                if (chartContainer) chartContainer.style.display = 'block';
            }
            
            // 显示参数信息
            if (result.parameters) {
                document.getElementById('emd-result-imf-count').textContent = result.parameters.imf_count;
                document.getElementById('emd-result-max-imf').textContent = result.parameters.max_imf;
                document.getElementById('emd-result-svr-lags').textContent = result.parameters.svr_lags;
            }

            // 显示误差指标
            if (result.metrics) {
                document.getElementById('emd-result-mae').textContent = result.metrics.mae.toFixed(6);
                document.getElementById('emd-result-rmse').textContent = result.metrics.rmse.toFixed(6);
                document.getElementById('emd-result-mse').textContent = result.metrics.mse.toFixed(6);
                document.getElementById('emd-result-mape').textContent = result.metrics.mape.toFixed(2) + '%';
            }

            // 绘制图表
            if (result.predictions) {
                const predCtx = document.getElementById('emd-prediction-chart');
                if (predCtx) {
                    if (emdPredictionChart) emdPredictionChart.destroy();
                    const observed = result.predictions.observed || [];
                    const predicted = result.predictions.predicted || [];
                    const indices = result.predictions.indices || [];
                    
                    emdPredictionChart = new Chart(predCtx, {
                        type: 'line',
                        data: {
                            labels: indices.map(i => `第${i}个`),
                            datasets: [{
                                label: '实际值',
                                data: observed,
                                borderColor: 'rgb(54, 162, 235)',
                                backgroundColor: 'rgba(54, 162, 235, 0.1)',
                                pointRadius: 3,
                                pointHoverRadius: 5
                            }, {
                                label: 'EMD+SVR+GM预测值',
                                data: predicted,
                                borderColor: 'rgb(255, 99, 132)',
                                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                                borderDash: [5, 5],
                                pointRadius: 3,
                                pointHoverRadius: 5
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: { display: true, position: 'top' },
                                tooltip: { mode: 'index', intersect: false }
                            },
                            scales: {
                                x: { title: { display: true, text: '序号' } },
                                y: { title: { display: true, text: '失效时间间隔' }, beginAtZero: true }
                            }
                        }
                    });
                }
            }

            // 显示预测结果表格
            if (result.predictions) {
                const tbody = document.getElementById('emd-prediction-tbody');
                if (tbody) {
                    tbody.innerHTML = '';
                    const observed = result.predictions.observed || [];
                    const predicted = result.predictions.predicted || [];
                    const indices = result.predictions.indices || [];
                    for (let i = 0; i < observed.length; i++) {
                        const row = tbody.insertRow();
                        row.insertCell(0).textContent = indices[i] || (i + 1);
                        row.insertCell(1).textContent = observed[i].toFixed(4);
                        row.insertCell(2).textContent = predicted[i] ? predicted[i].toFixed(4) : '-';
                        const error = predicted[i] ? (observed[i] - predicted[i]).toFixed(4) : '-';
                        row.insertCell(3).textContent = error;
                    }
                }
            }
        }

        function showEmdAnalyzeError(msg) {
            const errorDiv = document.getElementById('emd-analyze-error');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
            }
        }

        const emdResetBtn = document.getElementById('emd-reset-params');
        if (emdResetBtn) {
            emdResetBtn.addEventListener('click', () => {
                document.getElementById('emd-max-imf').value = '6';
                document.getElementById('emd-svr-lags').value = '3';
                document.getElementById('emd-svr-c').value = '1.0';
                document.getElementById('emd-svr-epsilon').value = '0.05';
                document.getElementById('emd-svr-kernel').value = 'rbf';
            });
        }

        // ========== Markov模型相关功能 ==========
        let markovCurrentConfig = null; // {services: [], transitions: []}

        // 切换输入方式
        const markovInputType = document.getElementById('markov-input-type');
        const markovDirectInput = document.getElementById('markov-direct-input');
        const markovDatabaseInput = document.getElementById('markov-database-input');
        
        if (markovInputType) {
            markovInputType.addEventListener('change', (e) => {
                if (e.target.value === 'direct') {
                    markovDirectInput.style.display = 'block';
                    markovDatabaseInput.style.display = 'none';
                } else {
                    markovDirectInput.style.display = 'none';
                    markovDatabaseInput.style.display = 'block';
                }
            });
        }

        // 添加服务
        let markovServiceCount = 0;
        const markovAddServiceBtn = document.getElementById('markov-add-service');
        const markovServicesContainer = document.getElementById('markov-services-container');
        
        function addMarkovServiceRow() {
            const div = document.createElement('div');
            div.className = 'filter-row';
            div.style.marginBottom = '10px';
            div.innerHTML = `
                <div style="flex:1;">
                    <input type="text" class="markov-service-name" placeholder="服务名称" style="width:100%; padding:8px;" />
                </div>
                <div style="flex:1;">
                    <input type="number" class="markov-service-reliability" placeholder="可靠度 (0-1)" step="0.001" min="0" max="1" style="width:100%; padding:8px;" />
                </div>
                <button type="button" class="btn secondary markov-remove-service" style="margin-left:10px;">删除</button>
            `;
            markovServicesContainer.appendChild(div);
            
            div.querySelector('.markov-remove-service').addEventListener('click', () => {
                div.remove();
            });
        }
        
        if (markovAddServiceBtn) {
            markovAddServiceBtn.addEventListener('click', addMarkovServiceRow);
            // 默认添加一个服务
            addMarkovServiceRow();
        }

        // 添加转移概率
        let markovTransitionCount = 0;
        const markovAddTransitionBtn = document.getElementById('markov-add-transition');
        const markovTransitionsContainer = document.getElementById('markov-transitions-container');
        
        function addMarkovTransitionRow() {
            const div = document.createElement('div');
            div.className = 'filter-row';
            div.style.marginBottom = '10px';
            div.innerHTML = `
                <div style="flex:1;">
                    <input type="text" class="markov-trans-from" placeholder="源服务名称" style="width:100%; padding:8px;" />
                </div>
                <div style="flex:1;">
                    <input type="text" class="markov-trans-to" placeholder="目标服务名称" style="width:100%; padding:8px;" />
                </div>
                <div style="flex:1;">
                    <input type="number" class="markov-trans-prob" placeholder="转移概率 (0-1)" step="0.001" min="0" max="1" style="width:100%; padding:8px;" />
                </div>
                <button type="button" class="btn secondary markov-remove-transition" style="margin-left:10px;">删除</button>
            `;
            markovTransitionsContainer.appendChild(div);
            
            div.querySelector('.markov-remove-transition').addEventListener('click', () => {
                div.remove();
            });
        }
        
        if (markovAddTransitionBtn) {
            markovAddTransitionBtn.addEventListener('click', addMarkovTransitionRow);
            // 默认添加一个转移
            addMarkovTransitionRow();
        }

        // 加载直接输入的数据
        const markovLoadDirectBtn = document.getElementById('markov-load-direct');
        if (markovLoadDirectBtn) {
            markovLoadDirectBtn.addEventListener('click', () => {
                const services = [];
                const transitions = [];
                
                // 收集服务
                markovServicesContainer.querySelectorAll('.filter-row').forEach(row => {
                    const name = row.querySelector('.markov-service-name')?.value.trim();
                    const reliability = parseFloat(row.querySelector('.markov-service-reliability')?.value);
                    if (name && !isNaN(reliability) && reliability >= 0 && reliability <= 1) {
                        services.push({ name, reliability });
                    }
                });
                
                // 收集转移
                markovTransitionsContainer.querySelectorAll('.filter-row').forEach(row => {
                    const from = row.querySelector('.markov-trans-from')?.value.trim();
                    const to = row.querySelector('.markov-trans-to')?.value.trim();
                    const prob = parseFloat(row.querySelector('.markov-trans-prob')?.value);
                    if (from && to && !isNaN(prob) && prob >= 0 && prob <= 1) {
                        transitions.push({ from, to, prob });
                    }
                });
                
                if (services.length === 0) {
                    showMarkovError('请至少添加一个服务');
                    return;
                }
                
                // 验证每个服务的转移概率和是否为1
                const serviceNames = services.map(s => s.name);
                const validationErrors = [];
                
                for (const serviceName of serviceNames) {
                    const serviceTransitions = transitions.filter(t => t.from === serviceName);
                    
                    if (serviceTransitions.length === 0) {
                        validationErrors.push(`服务 "${serviceName}" 没有设置任何转移概率。请添加至少一个转移（可以是自环）。`);
                        continue;
                    }
                    
                    const totalProb = serviceTransitions.reduce((sum, t) => sum + t.prob, 0);
                    const diff = Math.abs(totalProb - 1.0);
                    
                    if (diff > 0.0001) {
                        const transList = serviceTransitions.map(t => `${t.to}: ${t.prob.toFixed(4)}`).join(', ');
                        validationErrors.push(`服务 "${serviceName}" 的转移概率总和为 ${totalProb.toFixed(4)}，必须为 1.0。当前转移：${transList}`);
                    }
                }
                
                // 检查是否有无效的转移（指向不存在的服务）
                for (const trans of transitions) {
                    if (!serviceNames.includes(trans.from)) {
                        validationErrors.push(`转移 "${trans.from}" → "${trans.to}" 中的源服务 "${trans.from}" 不存在`);
                    }
                    if (!serviceNames.includes(trans.to)) {
                        validationErrors.push(`转移 "${trans.from}" → "${trans.to}" 中的目标服务 "${trans.to}" 不存在`);
                    }
                }
                
                if (validationErrors.length > 0) {
                    showMarkovError('配置验证失败：\n' + validationErrors.join('\n'));
                    return;
                }
                
                markovCurrentConfig = { services, transitions };
                displayMarkovConfig(markovCurrentConfig);
            });
        }

        // 从数据库导入
        const markovLoadDatabaseBtn = document.getElementById('markov-load-database');
        if (markovLoadDatabaseBtn) {
            markovLoadDatabaseBtn.addEventListener('click', async () => {
                const dbConfig = {
                    host: document.getElementById('markov-db-host')?.value || 'localhost',
                    user: document.getElementById('markov-db-user')?.value || 'root',
                    password: document.getElementById('markov-db-password')?.value || '',
                    database: document.getElementById('markov-db-database')?.value || 'markov',
                    services_table: 'services',
                    transitions_table: 'transitions',
                    config_table: 'config'
                };
                
                try {
                    const response = await fetch(`${API_BASE}/api/models/markov/import-data`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ db_config: dbConfig })
                    });
                    
                    const result = await response.json();
                    if (result.error) {
                        showMarkovError(result.error);
                        return;
                    }
                    
                    if (result.success) {
                        markovCurrentConfig = {
                            services: result.services,
                            transitions: result.transitions
                        };
                        displayMarkovConfig(markovCurrentConfig);
                        
                        // 设置初始分布和终止状态（如果有）
                        if (result.initial_distribution) {
                            document.getElementById('markov-initial-dist').value = result.initial_distribution.join(' ');
                        }
                        if (result.terminal_states && result.terminal_states.length > 0) {
                            document.getElementById('markov-terminal-states').value = result.terminal_states.join(',');
                        }
                    }
                } catch (error) {
                    showMarkovError(`导入失败: ${error.message}`);
                }
            });
        }

        function displayMarkovConfig(config) {
            const displayDiv = document.getElementById('markov-config-display');
            const contentDiv = document.getElementById('markov-config-content');
            const errorDiv = document.getElementById('markov-data-error');
            
            if (displayDiv) displayDiv.style.display = 'block';
            if (errorDiv) errorDiv.style.display = 'none';
            
            if (contentDiv) {
                let html = `<p><strong>服务数量：</strong>${config.services.length}</p>`;
                html += `<p><strong>转移数量：</strong>${config.transitions.length}</p>`;
                html += '<h5 style="margin-top:15px;">服务列表：</h5><ul>';
                config.services.forEach(svc => {
                    html += `<li>${svc.name} (可靠度: ${svc.reliability.toFixed(4)})</li>`;
                });
                html += '</ul>';
                contentDiv.innerHTML = html;
            }
        }

        function showMarkovError(msg) {
            const errorDiv = document.getElementById('markov-data-error');
            if (errorDiv) {
                errorDiv.innerHTML = msg.replace(/\n/g, '<br>');
                errorDiv.style.display = 'block';
                errorDiv.style.whiteSpace = 'pre-wrap';
                errorDiv.style.fontSize = '13px';
                errorDiv.style.lineHeight = '1.6';
            }
        }

        function showMarkovAnalyzeError(msg) {
            const errorDiv = document.getElementById('markov-analyze-error');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
            }
        }

        // Markov模型分析按钮
        const markovAnalyzeBtn = document.getElementById('markov-analyze-btn');
        if (markovAnalyzeBtn) {
            markovAnalyzeBtn.addEventListener('click', async () => {
                if (!markovCurrentConfig || !markovCurrentConfig.services || markovCurrentConfig.services.length === 0) {
                    showMarkovAnalyzeError('请先加载服务配置');
                    return;
                }
                
                const initialDistInput = document.getElementById('markov-initial-dist')?.value.trim();
                const terminalStatesInput = document.getElementById('markov-terminal-states')?.value.trim();
                
                let initialDistribution = null;
                if (initialDistInput) {
                    const parts = initialDistInput.split(/[,\s]+/).filter(p => p.trim());
                    if (parts.length > 0) {
                        initialDistribution = parts.map(p => parseFloat(p.trim())).filter(v => !isNaN(v));
                        if (initialDistribution.length !== markovCurrentConfig.services.length) {
                            showMarkovAnalyzeError(`初始分布长度必须等于服务数量 ${markovCurrentConfig.services.length}`);
                            return;
                        }
                    }
                }
                
                const terminalStates = terminalStatesInput ? terminalStatesInput.split(',').map(s => s.trim()).filter(s => s) : [];
                
                const loadingDiv = document.getElementById('markov-analyze-loading');
                const errorDiv = document.getElementById('markov-analyze-error');
                const resultsDiv = document.getElementById('markov-results');
                
                if (loadingDiv) loadingDiv.style.display = 'block';
                if (errorDiv) errorDiv.style.display = 'none';
                if (resultsDiv) resultsDiv.style.display = 'none';
                
                try {
                    const requestBody = {
                        data_type: 'direct',
                        services: markovCurrentConfig.services,
                        transitions: markovCurrentConfig.transitions
                    };
                    
                    if (initialDistribution) {
                        requestBody.initial_distribution = initialDistribution;
                    }
                    if (terminalStates.length > 0) {
                        requestBody.terminal_states = terminalStates;
                    }
                    
                    const response = await fetch(`${API_BASE}/api/models/markov/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody)
                    });
                    
                    const result = await response.json();
                    if (loadingDiv) loadingDiv.style.display = 'none';
                    
                    if (result.error) {
                        showMarkovAnalyzeError(result.error);
                        return;
                    }
                    
                    if (result.success) {
                        displayMarkovResults(result);
                        if (resultsDiv) resultsDiv.style.display = 'block';
                    }
                } catch (error) {
                    if (loadingDiv) loadingDiv.style.display = 'none';
                    showMarkovAnalyzeError(`分析失败: ${error.message}`);
                }
            });
        }

        function displayMarkovResults(result) {
            // 显示整体可靠度
            if (result.overall_reliability !== undefined) {
                const reliabilityEl = document.getElementById('markov-result-reliability');
                if (reliabilityEl) {
                    reliabilityEl.textContent = `${(result.overall_reliability * 100).toFixed(2)}%`;
                }
            }
            
            // 显示服务详情
            if (result.services) {
                const tbody = document.getElementById('markov-services-tbody');
                if (tbody) {
                    tbody.innerHTML = '';
                    result.services.forEach(svc => {
                        const row = tbody.insertRow();
                        row.insertCell(0).textContent = svc.name;
                        row.insertCell(1).textContent = (svc.reliability * 100).toFixed(2) + '%';
                        row.insertCell(2).textContent = (svc.steady_probability * 100).toFixed(2) + '%';
                    });
                }
            }
            
            // 显示迁移矩阵
            if (result.transition_matrix && result.parameters && result.parameters.service_names) {
                const thead = document.getElementById('markov-matrix-thead');
                const tbody = document.getElementById('markov-matrix-tbody');
                const serviceNames = result.parameters.service_names;
                
                if (thead && tbody) {
                    thead.innerHTML = '<tr><th></th>' + serviceNames.map(n => `<th>${n}</th>`).join('') + '</tr>';
                    tbody.innerHTML = '';
                    
                    result.transition_matrix.forEach((row, i) => {
                        const tr = tbody.insertRow();
                        tr.insertCell(0).textContent = serviceNames[i];
                        row.forEach(val => {
                            const cell = tr.insertCell();
                            cell.textContent = val.toFixed(4);
                        });
                    });
                }
            }
            
            // 稳态概率已在服务详情表格中显示，无需重复显示
        }

        // 重置参数
        const markovResetParamsBtn = document.getElementById('markov-reset-params');
        if (markovResetParamsBtn) {
            markovResetParamsBtn.addEventListener('click', () => {
                document.getElementById('markov-initial-dist').value = '';
                document.getElementById('markov-terminal-states').value = '';
            });
        }

        // ========== 用户管理相关功能 ==========
        let currentUserPage = 1;
        let currentUserPageSize = 10;
        let currentUserKeyword = '';
        let currentUserEditId = null;

        // 获取数据库配置
        function getUserDbConfig() {
            return {
                host: document.getElementById('user-db-host')?.value || 'localhost',
                user: document.getElementById('user-db-user')?.value || 'root',
                password: document.getElementById('user-db-password')?.value || '',
                database: document.getElementById('user-db-database')?.value || 'user_db'
            };
        }

        // 加载用户列表
        async function loadUserList() {
            const tbody = document.getElementById('user-list-tbody');
            const errorDiv = document.getElementById('user-list-error');
            const paginationDiv = document.getElementById('user-pagination');
            
            if (!tbody) return;

            try {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px; color:#666;">加载中...</td></tr>';
                
                const response = await fetch(`${API_BASE}/api/users/list`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        page: currentUserPage,
                        page_size: currentUserPageSize,
                        keyword: currentUserKeyword,
                        db_config: getUserDbConfig()
                    })
                });

                const result = await response.json();
                
                if (result.error) {
                    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding:20px; color:#c7393d;">${result.error}</td></tr>`;
                    if (errorDiv) {
                        errorDiv.textContent = result.error;
                        errorDiv.style.display = 'block';
                    }
                    return;
                }

                if (result.success && result.users) {
                    tbody.innerHTML = '';
                    if (result.users.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px; color:#666;">暂无用户数据</td></tr>';
                    } else {
                        result.users.forEach(user => {
                            const row = tbody.insertRow();
                            row.insertCell(0).textContent = user.id;
                            row.insertCell(1).textContent = user.username || '-';
                            row.insertCell(2).textContent = user.phone || '-';
                            row.insertCell(3).textContent = user.email || '-';
                            row.insertCell(4).textContent = user.create_time || '-';
                            row.insertCell(5).textContent = user.last_login_time || '-';
                            
                            const actionCell = row.insertCell(6);
                            actionCell.innerHTML = `
                                <a href="javascript:void(0);" class="user-edit-btn" data-id="${user.id}" data-username="${user.username || ''}" data-phone="${user.phone || ''}" data-email="${user.email || ''}">编辑</a> | 
                                <a href="javascript:void(0);" class="user-reset-pwd-btn" data-id="${user.id}" data-username="${user.username || ''}">重置密码</a> | 
                                <a href="javascript:void(0);" class="user-delete-btn" data-id="${user.id}" data-username="${user.username || ''}" style="color:#c7393d;">删除</a>
                            `;
                        });
                    }

                    // 更新分页信息
                    if (paginationDiv) {
                        const totalPages = Math.ceil(result.total / currentUserPageSize);
                        document.getElementById('user-page-info').textContent = `第 ${currentUserPage} 页，共 ${result.total} 条`;
                        document.getElementById('user-prev-btn').disabled = currentUserPage <= 1;
                        document.getElementById('user-next-btn').disabled = currentUserPage >= totalPages;
                        paginationDiv.style.display = 'block';
                    }

                    if (errorDiv) errorDiv.style.display = 'none';
                }
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px; color:#c7393d;">加载失败，请检查后端服务</td></tr>';
                if (errorDiv) {
                    errorDiv.textContent = `加载失败: ${error.message}`;
                    errorDiv.style.display = 'block';
                }
                console.error('加载用户列表错误:', error);
            }
        }

        // 刷新按钮
        const userRefreshBtn = document.getElementById('user-refresh-btn');
        if (userRefreshBtn) {
            userRefreshBtn.addEventListener('click', () => {
                currentUserPage = 1;
                loadUserList();
            });
        }

        // 搜索按钮
        const userSearchBtn = document.getElementById('user-search-btn');
        const userSearchInput = document.getElementById('user-search-input');
        if (userSearchBtn) {
            userSearchBtn.addEventListener('click', () => {
                currentUserKeyword = userSearchInput?.value.trim() || '';
                currentUserPage = 1;
                loadUserList();
            });
        }
        if (userSearchInput) {
            userSearchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    userSearchBtn?.click();
                }
            });
        }

        // 分页按钮
        const userPrevBtn = document.getElementById('user-prev-btn');
        const userNextBtn = document.getElementById('user-next-btn');
        if (userPrevBtn) {
            userPrevBtn.addEventListener('click', () => {
                if (currentUserPage > 1) {
                    currentUserPage--;
                    loadUserList();
                }
            });
        }
        if (userNextBtn) {
            userNextBtn.addEventListener('click', () => {
                currentUserPage++;
                loadUserList();
            });
        }

        // 编辑用户按钮（事件委托）
        document.addEventListener('click', async (e) => {
            if (e.target.classList.contains('user-edit-btn')) {
                const id = e.target.dataset.id;
                const username = e.target.dataset.username || '';
                const phone = e.target.dataset.phone || '';
                const email = e.target.dataset.email || '';
                
                currentUserEditId = id;
                document.getElementById('user-edit-id').value = id;
                document.getElementById('user-edit-username').value = username;
                document.getElementById('user-edit-username').disabled = true; // 编辑时不允许修改用户名
                document.getElementById('user-edit-password').value = '';
                document.getElementById('user-edit-password').placeholder = '留空则不修改密码';
                document.getElementById('user-edit-phone').value = phone;
                document.getElementById('user-edit-email').value = email;
                
                // 切换到编辑标签页
                const forecastTab = document.querySelector('.tab[data-tab="forecast"]');
                if (forecastTab) forecastTab.click();
            }
            
            if (e.target.classList.contains('user-reset-pwd-btn')) {
                const id = e.target.dataset.id;
                const username = e.target.dataset.username || '';
                const newPassword = prompt(`请输入 ${username} 的新密码:`);
                if (newPassword && newPassword.trim()) {
                    try {
                        const response = await fetch(`${API_BASE}/api/users/reset-password`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                user_id: parseInt(id),
                                new_password: newPassword.trim(),
                                db_config: getUserDbConfig()
                            })
                        });
                        const result = await response.json();
                        if (result.success) {
                            alert('密码重置成功');
                            loadUserList();
                        } else {
                            alert(`重置失败: ${result.error}`);
                        }
                    } catch (error) {
                        alert(`重置失败: ${error.message}`);
                    }
                }
            }
            
            if (e.target.classList.contains('user-delete-btn')) {
                const id = e.target.dataset.id;
                const username = e.target.dataset.username || '';
                if (confirm(`确定要删除用户 "${username}" 吗？此操作不可恢复！`)) {
                    try {
                        const response = await fetch(`${API_BASE}/api/users/delete`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                user_id: parseInt(id),
                                db_config: getUserDbConfig()
                            })
                        });
                        const result = await response.json();
                        if (result.success) {
                            alert('用户删除成功');
                            loadUserList();
                        } else {
                            alert(`删除失败: ${result.error}`);
                        }
                    } catch (error) {
                        alert(`删除失败: ${error.message}`);
                    }
                }
            }
        });

        // 保存用户按钮
        const userEditSaveBtn = document.getElementById('user-edit-save');
        if (userEditSaveBtn) {
            userEditSaveBtn.addEventListener('click', async () => {
                const errorDiv = document.getElementById('user-edit-error');
                const successDiv = document.getElementById('user-edit-success');
                const id = document.getElementById('user-edit-id').value;
                const username = document.getElementById('user-edit-username').value.trim();
                const password = document.getElementById('user-edit-password').value.trim();
                const phone = document.getElementById('user-edit-phone').value.trim() || null;
                const email = document.getElementById('user-edit-email').value.trim() || null;

                if (errorDiv) errorDiv.style.display = 'none';
                if (successDiv) successDiv.style.display = 'none';

                if (!username) {
                    if (errorDiv) {
                        errorDiv.textContent = '用户名不能为空';
                        errorDiv.style.display = 'block';
                    }
                    return;
                }

                try {
                    if (id && currentUserEditId) {
                        // 编辑模式
                        const updateData = { user_id: parseInt(id), db_config: getUserDbConfig() };
                        if (phone !== null) updateData.phone = phone;
                        if (email !== null) updateData.email = email;

                        const response = await fetch(`${API_BASE}/api/users/update`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(updateData)
                        });
                        const result = await response.json();

                        if (result.success) {
                            // 如果提供了新密码，则重置密码
                            if (password) {
                                const pwdResponse = await fetch(`${API_BASE}/api/users/reset-password`, {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        user_id: parseInt(id),
                                        new_password: password,
                                        db_config: getUserDbConfig()
                                    })
                                });
                                const pwdResult = await pwdResponse.json();
                                if (!pwdResult.success) {
                                    if (errorDiv) {
                                        errorDiv.textContent = `更新成功，但密码重置失败: ${pwdResult.error}`;
                                        errorDiv.style.display = 'block';
                                    }
                                    return;
                                }
                            }

                            if (successDiv) {
                                successDiv.textContent = '用户信息更新成功';
                                successDiv.style.display = 'block';
                            }
                            loadUserList();
                        } else {
                            if (errorDiv) {
                                errorDiv.textContent = result.error || '更新失败';
                                errorDiv.style.display = 'block';
                            }
                        }
                    } else {
                        // 新增模式
                        if (!password) {
                            if (errorDiv) {
                                errorDiv.textContent = '新增用户时密码不能为空';
                                errorDiv.style.display = 'block';
                            }
                            return;
                        }

                        const response = await fetch(`${API_BASE}/api/users/create`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                username: username,
                                password: password,
                                phone: phone,
                                email: email,
                                db_config: getUserDbConfig()
                            })
                        });
                        const result = await response.json();

                        if (result.success) {
                            if (successDiv) {
                                successDiv.textContent = '用户创建成功';
                                successDiv.style.display = 'block';
                            }
                            document.getElementById('user-edit-clear').click();
                            loadUserList();
                        } else {
                            if (errorDiv) {
                                errorDiv.textContent = result.error || '创建失败';
                                errorDiv.style.display = 'block';
                            }
                        }
                    }
                } catch (error) {
                    if (errorDiv) {
                        errorDiv.textContent = `操作失败: ${error.message}`;
                        errorDiv.style.display = 'block';
                    }
                    console.error('保存用户错误:', error);
                }
            });
        }

        // 清空按钮
        const userEditClearBtn = document.getElementById('user-edit-clear');
        if (userEditClearBtn) {
            userEditClearBtn.addEventListener('click', () => {
                currentUserEditId = null;
                document.getElementById('user-edit-id').value = '';
                document.getElementById('user-edit-username').value = '';
                document.getElementById('user-edit-username').disabled = false;
                document.getElementById('user-edit-password').value = '';
                document.getElementById('user-edit-password').placeholder = '请输入密码（必填）';
                document.getElementById('user-edit-phone').value = '';
                document.getElementById('user-edit-email').value = '';
                const errorDiv = document.getElementById('user-edit-error');
                const successDiv = document.getElementById('user-edit-success');
                if (errorDiv) errorDiv.style.display = 'none';
                if (successDiv) successDiv.style.display = 'none';
            });
        }

        // 当切换到用户管理模块时，自动加载用户列表
        const userMgmtItem = document.querySelector('.menu-item[data-model="user_mgmt"]');
        if (userMgmtItem) {
            userMgmtItem.addEventListener('click', () => {
                setTimeout(() => {
                    const failureTab = document.querySelector('.tab[data-tab="failure"]');
                    if (failureTab && !failureTab.classList.contains('active')) {
                        failureTab.click();
                    }
                    loadUserList();
                }, 100);
            });
        }

        // ========== 性能对比分析相关功能 ==========
        let perfComparisonChart = null;

        // 切换输入方式
        const perfInputType = document.getElementById('perf-input-type');
        const perfDirectInput = document.getElementById('perf-direct-input');
        const perfCsvInput = document.getElementById('perf-csv-input');
        const perfDatabaseInput = document.getElementById('perf-database-input');
        
        if (perfInputType) {
            perfInputType.addEventListener('change', (e) => {
                if (e.target.value === 'direct') {
                    perfDirectInput.style.display = 'block';
                    perfCsvInput.style.display = 'none';
                    perfDatabaseInput.style.display = 'none';
                } else if (e.target.value === 'csv') {
                    perfDirectInput.style.display = 'none';
                    perfCsvInput.style.display = 'block';
                    perfDatabaseInput.style.display = 'none';
                } else {
                    perfDirectInput.style.display = 'none';
                    perfCsvInput.style.display = 'none';
                    perfDatabaseInput.style.display = 'block';
                }
            });
        }

        // 性能对比CSV文件分析
        const perfAnalyzeCsvBtn = document.getElementById('perf-analyze-csv-btn');
        if (perfAnalyzeCsvBtn) {
            perfAnalyzeCsvBtn.addEventListener('click', async () => {
                const fileInput = document.getElementById('perf-csv-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    alert('请先选择CSV文件');
                    return;
                }
                
                parseCSVFile(file, async (error, data) => {
                    if (error) {
                        alert('CSV文件导入失败: ' + error.message);
                        return;
                    }
                    
                    // 直接进行分析
                    try {
                        const response = await fetch(`${API_BASE}/api/compare/performance`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ data: data })
                        });
                        const result = await response.json();
                        if (result.error) {
                            alert('分析失败: ' + result.error);
                            return;
                        }
                        displayPerfResults(result);
                    } catch (error) {
                        alert('分析失败: ' + error.message);
                    }
                });
            });
        }

        // 直接输入分析
        const perfAnalyzeBtn = document.getElementById('perf-analyze-btn');
        if (perfAnalyzeBtn) {
            perfAnalyzeBtn.addEventListener('click', async () => {
                const inputText = document.getElementById('perf-intervals-input')?.value.trim();
                if (!inputText) {
                    showPerfError('请输入失效时间间隔序列');
                    return;
                }
                
                const values = inputText.split(/\s+/).map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
                if (values.length === 0) {
                    showPerfError('无法解析输入数据，请确保使用空格分隔数字');
                    return;
                }
                
                await runPerformanceCompare({ data_type: 'direct', data: values });
            });
        }

        // 数据库导入分析
        const perfAnalyzeDbBtn = document.getElementById('perf-analyze-db-btn');
        if (perfAnalyzeDbBtn) {
            perfAnalyzeDbBtn.addEventListener('click', async () => {
                const dbConfig = {
                    host: document.getElementById('perf-db-host')?.value || 'localhost',
                    user: document.getElementById('perf-db-user')?.value || 'root',
                    password: document.getElementById('perf-db-password')?.value || '',
                    database: document.getElementById('perf-db-database')?.value || 'compare',
                    table: document.getElementById('perf-db-table')?.value || 'timi'
                };
                
                await runPerformanceCompare({ data_type: 'database', db_config: dbConfig });
            });
        }

        async function runPerformanceCompare(requestBody) {
            const loadingDiv = document.getElementById('perf-analyze-loading');
            const errorDiv = document.getElementById('perf-analyze-error');
            const resultsDiv = document.getElementById('perf-results');
            
            if (loadingDiv) loadingDiv.style.display = 'block';
            if (errorDiv) errorDiv.style.display = 'none';
            if (resultsDiv) resultsDiv.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/api/compare/performance`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                const result = await response.json();
                if (loadingDiv) loadingDiv.style.display = 'none';
                
                if (result.error) {
                    showPerfError(result.error);
                    return;
                }
                
                if (result.success) {
                    displayPerfResults(result);
                    if (resultsDiv) resultsDiv.style.display = 'block';
                }
            } catch (error) {
                if (loadingDiv) loadingDiv.style.display = 'none';
                showPerfError(`分析失败: ${error.message}`);
            }
        }

        function displayPerfResults(result) {
            // 显示matplotlib生成的图表
            if (result.chart_image) {
                const matplotlibDiv = document.getElementById('perf-matplotlib-chart');
                const chartContainer = document.getElementById('perf-chart-container');
                const chartImg = document.getElementById('perf-chart-image');
                
                if (matplotlibDiv && chartImg) {
                    chartImg.src = 'data:image/png;base64,' + result.chart_image;
                    matplotlibDiv.style.display = 'block';
                    if (chartContainer) chartContainer.style.display = 'none';
                }
            } else {
                const matplotlibDiv = document.getElementById('perf-matplotlib-chart');
                const chartContainer = document.getElementById('perf-chart-container');
                if (matplotlibDiv) matplotlibDiv.style.display = 'none';
                if (chartContainer) chartContainer.style.display = 'block';
            }
            
            const tbody = document.getElementById('perf-results-tbody');
            if (tbody) {
                tbody.innerHTML = '';
                result.results.forEach(modelResult => {
                    const row = tbody.insertRow();
                    row.insertCell(0).textContent = modelResult.model;
                    row.insertCell(1).textContent = modelResult.mae !== null ? modelResult.mae.toFixed(6) : '-';
                    row.insertCell(2).textContent = modelResult.rmse !== null ? modelResult.rmse.toFixed(6) : '-';
                    row.insertCell(3).textContent = modelResult.r2 !== null ? modelResult.r2.toFixed(6) : '-';
                    row.insertCell(4).textContent = modelResult.time !== null ? modelResult.time.toFixed(6) : '-';
                    row.insertCell(5).textContent = modelResult.success ? '成功' : (modelResult.error || '失败');
                    if (!modelResult.success) {
                        row.cells[5].style.color = '#c7393d';
                    }
                });
            }
            
            // 绘制对比图表
            const chartCtx = document.getElementById('perf-comparison-chart');
            if (chartCtx) {
                if (perfComparisonChart) perfComparisonChart.destroy();
                
                const models = result.results.filter(r => r.success).map(r => r.model);
                const maeVals = result.results.filter(r => r.success).map(r => r.mae);
                const rmseVals = result.results.filter(r => r.success).map(r => r.rmse);
                const r2Vals = result.results.filter(r => r.success).map(r => Math.abs(r.r2 || 0));
                const timeVals = result.results.filter(r => r.success).map(r => r.time);
                
                perfComparisonChart = new Chart(chartCtx, {
                    type: 'bar',
                    data: {
                        labels: models,
                        datasets: [
                            {
                                label: 'MAE',
                                data: maeVals,
                                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                borderColor: 'rgb(54, 162, 235)',
                                borderWidth: 1
                            },
                            {
                                label: 'RMSE',
                                data: rmseVals,
                                backgroundColor: 'rgba(255, 99, 132, 0.6)',
                                borderColor: 'rgb(255, 99, 132)',
                                borderWidth: 1
                            },
                            {
                                label: '|R²|',
                                data: r2Vals,
                                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                                borderColor: 'rgb(75, 192, 192)',
                                borderWidth: 1
                            },
                            {
                                label: '耗时(s)',
                                data: timeVals,
                                backgroundColor: 'rgba(255, 159, 64, 0.6)',
                                borderColor: 'rgb(255, 159, 64)',
                                borderWidth: 1,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: { mode: 'index', intersect: false }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: { display: true, text: 'MAE/RMSE/|R²|' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { display: true, text: '耗时(s)' },
                                grid: { drawOnChartArea: false }
                            }
                        }
                    }
                });
            }
        }

        function showPerfError(msg) {
            const errorDiv = document.getElementById('perf-analyze-error');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
            }
        }

        // ========== SLR对比分析相关功能 ==========
        let slrPredictionChart = null;
        let slrMetricsChart = null;

        // 切换输入方式
        const slrInputType = document.getElementById('slr-input-type');
        const slrDirectInput = document.getElementById('slr-direct-input');
        const slrCsvInput = document.getElementById('slr-csv-input');
        const slrDatabaseInput = document.getElementById('slr-database-input');
        
        if (slrInputType) {
            slrInputType.addEventListener('change', (e) => {
                if (e.target.value === 'direct') {
                    slrDirectInput.style.display = 'block';
                    slrCsvInput.style.display = 'none';
                    slrDatabaseInput.style.display = 'none';
                } else if (e.target.value === 'csv') {
                    slrDirectInput.style.display = 'none';
                    slrCsvInput.style.display = 'block';
                    slrDatabaseInput.style.display = 'none';
                } else {
                    slrDirectInput.style.display = 'none';
                    slrCsvInput.style.display = 'none';
                    slrDatabaseInput.style.display = 'block';
                }
            });
        }

        // SLR对比CSV文件分析
        const slrAnalyzeCsvBtn = document.getElementById('slr-analyze-csv-btn');
        if (slrAnalyzeCsvBtn) {
            slrAnalyzeCsvBtn.addEventListener('click', async () => {
                const fileInput = document.getElementById('slr-csv-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    showSlrError('请先选择CSV文件');
                    return;
                }
                
                parseCSVFile(file, async (error, data) => {
                    if (error) {
                        showSlrError('CSV文件导入失败: ' + error.message);
                        return;
                    }
                    
                    // 直接进行分析
                    try {
                        const response = await fetch(`${API_BASE}/api/compare/slr`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ data: data })
                        });
                        const result = await response.json();
                        if (result.error) {
                            showSlrError('分析失败: ' + result.error);
                            return;
                        }
                        displaySlrResults(result);
                    } catch (error) {
                        showSlrError('分析失败: ' + error.message);
                    }
                });
            });
        }

        // 直接输入分析
        const slrAnalyzeBtn = document.getElementById('slr-analyze-btn');
        if (slrAnalyzeBtn) {
            slrAnalyzeBtn.addEventListener('click', async () => {
                const inputText = document.getElementById('slr-intervals-input')?.value.trim();
                if (!inputText) {
                    showSlrError('请输入失效时间间隔序列');
                    return;
                }
                
                const values = inputText.split(/\s+/).map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
                if (values.length === 0) {
                    showSlrError('无法解析输入数据，请确保使用空格分隔数字');
                    return;
                }
                
                await runSlrCompare({ data_type: 'direct', data: values });
            });
        }

        // 数据库导入分析
        const slrAnalyzeDbBtn = document.getElementById('slr-analyze-db-btn');
        if (slrAnalyzeDbBtn) {
            slrAnalyzeDbBtn.addEventListener('click', async () => {
                const dbConfig = {
                    host: document.getElementById('slr-db-host')?.value || 'localhost',
                    user: document.getElementById('slr-db-user')?.value || 'root',
                    password: document.getElementById('slr-db-password')?.value || '',
                    database: document.getElementById('slr-db-database')?.value || 'slr',
                    table: document.getElementById('slr-db-table')?.value || 'timi'
                };
                
                await runSlrCompare({ data_type: 'database', db_config: dbConfig });
            });
        }

        async function runSlrCompare(requestBody) {
            const loadingDiv = document.getElementById('slr-analyze-loading');
            const errorDiv = document.getElementById('slr-analyze-error');
            const resultsDiv = document.getElementById('slr-results');
            const statsDiv = document.getElementById('slr-data-stats');
            
            if (loadingDiv) loadingDiv.style.display = 'block';
            if (errorDiv) errorDiv.style.display = 'none';
            if (resultsDiv) resultsDiv.style.display = 'none';
            if (statsDiv) statsDiv.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/api/compare/slr`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                const result = await response.json();
                if (loadingDiv) loadingDiv.style.display = 'none';
                
                if (result.error) {
                    showSlrError(result.error);
                    return;
                }
                
                if (result.success) {
                    displaySlrResults(result, requestBody);
                    if (resultsDiv) resultsDiv.style.display = 'block';
                    if (statsDiv && result.data_statistics) {
                        displaySlrStats(result.data_statistics, result.data_length);
                        statsDiv.style.display = 'block';
                    }
                }
            } catch (error) {
                if (loadingDiv) loadingDiv.style.display = 'none';
                showSlrError(`分析失败: ${error.message}`);
            }
        }

        function displaySlrStats(stats, dataLength) {
            const statsContent = document.getElementById('slr-stats-content');
            if (statsContent && stats) {
                const safeValue = (val) => {
                    if (val === null || val === undefined || isNaN(val)) return '-';
                    return Number(val).toFixed(4);
                };
                
                statsContent.innerHTML = `
                    <div class="stat-card" style="margin-right:15px;">
                        <h4>数据点数</h4>
                        <p>${dataLength || '-'}</p>
                    </div>
                    <div class="stat-card" style="margin-right:15px;">
                        <h4>均值</h4>
                        <p>${safeValue(stats.mean)}</p>
                    </div>
                    <div class="stat-card" style="margin-right:15px;">
                        <h4>标准差</h4>
                        <p>${safeValue(stats.std)}</p>
                    </div>
                    <div class="stat-card" style="margin-right:15px;">
                        <h4>最小值</h4>
                        <p>${safeValue(stats.min)}</p>
                    </div>
                    <div class="stat-card" style="margin-right:15px;">
                        <h4>最大值</h4>
                        <p>${safeValue(stats.max)}</p>
                    </div>
                    <div class="stat-card">
                        <h4>总和</h4>
                        <p>${safeValue(stats.sum)}</p>
                    </div>
                `;
            }
        }

        function displaySlrResults(result, requestBody = null) {
            // 显示matplotlib生成的图表
            if (result.chart_image) {
                const matplotlibDiv = document.getElementById('slr-matplotlib-chart');
                const chartContainer = document.getElementById('slr-chart-container');
                const chartImg = document.getElementById('slr-chart-image');
                
                if (matplotlibDiv && chartImg) {
                    chartImg.src = 'data:image/png;base64,' + result.chart_image;
                    matplotlibDiv.style.display = 'block';
                    if (chartContainer) chartContainer.style.display = 'none';
                }
            } else {
                const matplotlibDiv = document.getElementById('slr-matplotlib-chart');
                const chartContainer = document.getElementById('slr-chart-container');
                if (matplotlibDiv) matplotlibDiv.style.display = 'none';
                if (chartContainer) chartContainer.style.display = 'block';
            }
            
            const tbody = document.getElementById('slr-results-tbody');
            if (tbody) {
                tbody.innerHTML = '';
                Object.entries(result.results).forEach(([modelName, modelResult]) => {
                    if (modelResult.success) {
                        const metrics = modelResult.metrics || {};
                        const safeMetric = (val, decimals = 6) => {
                            if (val === null || val === undefined || isNaN(val)) return '-';
                            return Number(val).toFixed(decimals);
                        };
                        
                        const row = tbody.insertRow();
                        row.insertCell(0).textContent = modelName;
                        row.insertCell(1).textContent = safeMetric(metrics.MSE);
                        row.insertCell(2).textContent = safeMetric(metrics.RMSE);
                        row.insertCell(3).textContent = safeMetric(metrics.MAE);
                        row.insertCell(4).textContent = safeMetric(metrics.MAPE, 2);
                        row.insertCell(5).textContent = safeMetric(metrics['R²']);
                        row.insertCell(6).textContent = safeMetric(modelResult.time);
                        row.insertCell(7).textContent = '成功';
                    } else {
                        const row = tbody.insertRow();
                        row.insertCell(0).textContent = modelName;
                        for (let i = 0; i < 6; i++) {
                            row.insertCell(i + 1).textContent = '-';
                        }
                        const statusCell = row.insertCell(7);
                        statusCell.textContent = modelResult.error || '失败';
                        statusCell.style.color = '#c7393d';
                    }
                });
            }
            
            // 找出最佳模型
            const bestModelsContent = document.getElementById('slr-best-models-content');
            if (bestModelsContent) {
                const validResults = Object.entries(result.results).filter(([_, r]) => r.success);
                if (validResults.length > 0) {
                    let bestRMSE = null, bestMAE = null, bestR2 = null;
                    let bestRMSEModel = null, bestMAEModel = null, bestR2Model = null;
                    
                    validResults.forEach(([name, r]) => {
                        const m = r.metrics || {};
                        if (m.RMSE !== undefined && (bestRMSE === null || m.RMSE < bestRMSE)) {
                            bestRMSE = m.RMSE;
                            bestRMSEModel = name;
                        }
                        if (m.MAE !== undefined && (bestMAE === null || m.MAE < bestMAE)) {
                            bestMAE = m.MAE;
                            bestMAEModel = name;
                        }
                        if (m['R²'] !== undefined && (bestR2 === null || m['R²'] > bestR2)) {
                            bestR2 = m['R²'];
                            bestR2Model = name;
                        }
                    });
                    
                    let html = '';
                    if (bestRMSEModel && bestRMSE !== null && !isNaN(bestRMSE)) {
                        html += `<p><strong>按RMSE（均方根误差）：</strong>${bestRMSEModel} (RMSE=${Number(bestRMSE).toFixed(6)})</p>`;
                    }
                    if (bestMAEModel && bestMAE !== null && !isNaN(bestMAE)) {
                        html += `<p><strong>按MAE（平均绝对误差）：</strong>${bestMAEModel} (MAE=${Number(bestMAE).toFixed(6)})</p>`;
                    }
                    if (bestR2Model && bestR2 !== null && !isNaN(bestR2)) {
                        html += `<p><strong>按R²（决定系数）：</strong>${bestR2Model} (R²=${Number(bestR2).toFixed(6)})</p>`;
                    }
                    bestModelsContent.innerHTML = html;
                }
            }
            
            // 绘制预测对比图表
            const predChartCtx = document.getElementById('slr-prediction-chart');
            if (predChartCtx && result.data_length && result.data_length > 0) {
                if (slrPredictionChart) slrPredictionChart.destroy();
                
                const dataLength = result.data_length || 0;
                const indices = Array.from({length: dataLength}, (_, i) => i + 1);
                const datasets = [];
                
                // 添加原始数据
                if (result.original_data && Array.isArray(result.original_data) && result.original_data.length > 0) {
                    datasets.push({
                        label: '原始数据',
                        data: result.original_data.slice(0, dataLength),
                        borderColor: 'rgb(0, 0, 0)',
                        backgroundColor: 'rgba(0, 0, 0, 0.1)',
                        borderWidth: 2,
                        pointRadius: 3
                    });
                }
                
                // 添加各模型预测
                const colors = ['rgb(255, 99, 132)', 'rgb(54, 162, 235)', 'rgb(75, 192, 192)'];
                let colorIdx = 0;
                Object.entries(result.results).forEach(([name, r]) => {
                    if (r.success && r.predictions && Array.isArray(r.predictions) && r.predictions.length > 0) {
                        datasets.push({
                            label: `${name}预测`,
                            data: r.predictions.slice(0, dataLength),
                            borderColor: colors[colorIdx % colors.length],
                            backgroundColor: colors[colorIdx % colors.length].replace('rgb', 'rgba').replace(')', ', 0.1)'),
                            borderWidth: 1.5,
                            borderDash: [5, 5],
                            pointRadius: 2
                        });
                        colorIdx++;
                    }
                });
                
                // 只有在有数据集时才绘制图表
                if (datasets.length === 0) {
                    return;
                }
                
                slrPredictionChart = new Chart(predChartCtx, {
                    type: 'line',
                    data: {
                        labels: indices.map(i => `第${i}个`),
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: { mode: 'index', intersect: false }
                        },
                        scales: {
                            x: { title: { display: true, text: '序号' } },
                            y: { title: { display: true, text: '失效时间间隔' }, beginAtZero: true }
                        }
                    }
                });
            }
            
            // 绘制性能指标对比图表
            const metricsChartCtx = document.getElementById('slr-metrics-chart');
            if (metricsChartCtx) {
                if (slrMetricsChart) slrMetricsChart.destroy();
                
                const models = Object.keys(result.results).filter(name => result.results[name].success);
                if (models.length === 0) {
                    return; // 没有成功的模型，不绘制图表
                }
                
                const metrics = ['RMSE', 'MAE', 'MAPE'];
                const datasets = metrics.map((metric, idx) => {
                    const data = models.map(name => {
                        const m = result.results[name].metrics || {};
                        const val = m[metric];
                        // 安全处理null/undefined/NaN值
                        if (val === null || val === undefined || isNaN(val)) {
                            return 0;
                        }
                        return Number(val);
                    });
                    return {
                        label: metric,
                        data: data,
                        backgroundColor: ['rgba(255, 99, 132, 0.6)', 'rgba(54, 162, 235, 0.6)', 'rgba(75, 192, 192, 0.6)'][idx],
                        borderColor: ['rgb(255, 99, 132)', 'rgb(54, 162, 235)', 'rgb(75, 192, 192)'][idx],
                        borderWidth: 1
                    };
                });
                
                // 只有在有数据集时才绘制图表
                if (datasets.length === 0) {
                    return;
                }
                
                slrMetricsChart = new Chart(metricsChartCtx, {
                    type: 'bar',
                    data: {
                        labels: models,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            tooltip: { mode: 'index', intersect: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: '指标值' }
                            }
                        }
                    }
                });
            }
        }

        function showSlrError(msg) {
            const errorDiv = document.getElementById('slr-analyze-error');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
            }
        }
    </script>
</body>
</html>

